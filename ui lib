--[[
    milk.chocolate UI Library v2.2
    A Linoria-style UI with multiple themes
    Features: Key System, Notifications, Draggable Widgets, Themes, and more
    
    Changes in v2.2:
    - Fixed button/dropdown theme color persistence
    - Added visible resize indicator (3 lines)
    - Improved color picker with color wheel + RGB input
    - Fixed dropdown theme line issues
    - Improved text visibility (more white/bright)
    - Added "Always", "Toggle", "Hold" keybind modes
    - Added glow effects throughout UI
]]

local MilkChocolate = {}
MilkChocolate.__index = MilkChocolate

-- Services
local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local HttpService = game:GetService("HttpService")
local CoreGui = game:GetService("CoreGui")

local Player = Players.LocalPlayer

-- Theme Definitions
local Themes = {
    ["Milk Chocolate"] = {
        Name = "Milk Chocolate",
        TitleGlow1 = Color3.fromRGB(255, 255, 255),
        TitleGlow2 = Color3.fromRGB(139, 90, 43),
        Background = Color3.fromRGB(35, 28, 24),
        BackgroundDark = Color3.fromRGB(28, 22, 18),
        BackgroundLight = Color3.fromRGB(45, 36, 30),
        Accent = Color3.fromRGB(139, 90, 43),
        AccentLight = Color3.fromRGB(180, 130, 80),
        AccentDark = Color3.fromRGB(100, 65, 30),
        AccentGlow = Color3.fromRGB(180, 120, 60),
        PastelMain = Color3.fromRGB(200, 160, 130),
        PastelCream = Color3.fromRGB(255, 250, 245),
        Border = Color3.fromRGB(70, 55, 45),
        BorderHover = Color3.fromRGB(139, 90, 43),
        Text = Color3.fromRGB(255, 250, 245),
        TextDark = Color3.fromRGB(200, 190, 180),
        TextDisabled = Color3.fromRGB(120, 110, 100),
        Glow = Color3.fromRGB(139, 90, 43),
        GlowTransparency = 0.85,
        Toggle = Color3.fromRGB(139, 90, 43),
        ToggleOff = Color3.fromRGB(60, 48, 40),
        Dropdown = Color3.fromRGB(40, 32, 26),
        Notification = Color3.fromRGB(35, 28, 24),
        KeybindActive = Color3.fromRGB(255, 220, 150),
    },
    ["White Chocolate"] = {
        Name = "White Chocolate",
        TitleGlow1 = Color3.fromRGB(60, 50, 40),
        TitleGlow2 = Color3.fromRGB(180, 160, 120),
        Background = Color3.fromRGB(250, 245, 235),
        BackgroundDark = Color3.fromRGB(235, 228, 215),
        BackgroundLight = Color3.fromRGB(255, 252, 248),
        Accent = Color3.fromRGB(180, 155, 110),
        AccentLight = Color3.fromRGB(200, 175, 130),
        AccentDark = Color3.fromRGB(160, 135, 90),
        AccentGlow = Color3.fromRGB(200, 175, 130),
        PastelMain = Color3.fromRGB(140, 120, 90),
        PastelCream = Color3.fromRGB(60, 50, 40),
        Border = Color3.fromRGB(200, 185, 165),
        BorderHover = Color3.fromRGB(160, 135, 90),
        Text = Color3.fromRGB(50, 40, 30),
        TextDark = Color3.fromRGB(90, 80, 65),
        TextDisabled = Color3.fromRGB(150, 140, 125),
        Glow = Color3.fromRGB(180, 155, 110),
        GlowTransparency = 0.9,
        Toggle = Color3.fromRGB(180, 155, 110),
        ToggleOff = Color3.fromRGB(210, 200, 185),
        Dropdown = Color3.fromRGB(240, 233, 220),
        Notification = Color3.fromRGB(250, 245, 235),
        KeybindActive = Color3.fromRGB(120, 160, 80),
    },
    ["Oreo"] = {
        Name = "Oreo",
        TitleGlow1 = Color3.fromRGB(255, 255, 255),
        TitleGlow2 = Color3.fromRGB(80, 80, 90),
        Background = Color3.fromRGB(25, 25, 28),
        BackgroundDark = Color3.fromRGB(18, 18, 20),
        BackgroundLight = Color3.fromRGB(38, 38, 42),
        Accent = Color3.fromRGB(245, 245, 250),
        AccentLight = Color3.fromRGB(255, 255, 255),
        AccentDark = Color3.fromRGB(200, 200, 210),
        AccentGlow = Color3.fromRGB(255, 255, 255),
        PastelMain = Color3.fromRGB(200, 200, 210),
        PastelCream = Color3.fromRGB(255, 255, 255),
        Border = Color3.fromRGB(60, 60, 68),
        BorderHover = Color3.fromRGB(245, 245, 250),
        Text = Color3.fromRGB(255, 255, 255),
        TextDark = Color3.fromRGB(200, 200, 210),
        TextDisabled = Color3.fromRGB(100, 100, 110),
        Glow = Color3.fromRGB(255, 255, 255),
        GlowTransparency = 0.9,
        Toggle = Color3.fromRGB(245, 245, 250),
        ToggleOff = Color3.fromRGB(55, 55, 62),
        Dropdown = Color3.fromRGB(32, 32, 36),
        Notification = Color3.fromRGB(25, 25, 28),
        KeybindActive = Color3.fromRGB(150, 255, 150),
    },
    ["Mint"] = {
        Name = "Mint",
        TitleGlow1 = Color3.fromRGB(255, 255, 255),
        TitleGlow2 = Color3.fromRGB(80, 200, 150),
        Background = Color3.fromRGB(25, 35, 32),
        BackgroundDark = Color3.fromRGB(18, 28, 25),
        BackgroundLight = Color3.fromRGB(38, 50, 45),
        Accent = Color3.fromRGB(80, 200, 150),
        AccentLight = Color3.fromRGB(120, 230, 180),
        AccentDark = Color3.fromRGB(50, 150, 110),
        AccentGlow = Color3.fromRGB(100, 220, 170),
        PastelMain = Color3.fromRGB(150, 220, 190),
        PastelCream = Color3.fromRGB(240, 255, 250),
        Border = Color3.fromRGB(50, 75, 65),
        BorderHover = Color3.fromRGB(80, 200, 150),
        Text = Color3.fromRGB(240, 255, 250),
        TextDark = Color3.fromRGB(180, 210, 200),
        TextDisabled = Color3.fromRGB(90, 120, 110),
        Glow = Color3.fromRGB(80, 200, 150),
        GlowTransparency = 0.85,
        Toggle = Color3.fromRGB(80, 200, 150),
        ToggleOff = Color3.fromRGB(50, 70, 62),
        Dropdown = Color3.fromRGB(32, 45, 40),
        Notification = Color3.fromRGB(25, 35, 32),
        KeybindActive = Color3.fromRGB(150, 255, 200),
    },
    ["Dubai"] = {
        Name = "Dubai",
        TitleGlow1 = Color3.fromRGB(255, 255, 255),
        TitleGlow2 = Color3.fromRGB(212, 175, 55),
        Background = Color3.fromRGB(20, 18, 25),
        BackgroundDark = Color3.fromRGB(15, 13, 18),
        BackgroundLight = Color3.fromRGB(32, 28, 40),
        Accent = Color3.fromRGB(212, 175, 55),
        AccentLight = Color3.fromRGB(245, 210, 90),
        AccentDark = Color3.fromRGB(170, 140, 40),
        AccentGlow = Color3.fromRGB(235, 200, 80),
        PastelMain = Color3.fromRGB(230, 200, 120),
        PastelCream = Color3.fromRGB(255, 250, 235),
        Border = Color3.fromRGB(55, 48, 65),
        BorderHover = Color3.fromRGB(212, 175, 55),
        Text = Color3.fromRGB(255, 250, 240),
        TextDark = Color3.fromRGB(200, 190, 170),
        TextDisabled = Color3.fromRGB(100, 95, 85),
        Glow = Color3.fromRGB(212, 175, 55),
        GlowTransparency = 0.85,
        Toggle = Color3.fromRGB(212, 175, 55),
        ToggleOff = Color3.fromRGB(55, 48, 65),
        Dropdown = Color3.fromRGB(28, 24, 35),
        Notification = Color3.fromRGB(20, 18, 25),
        KeybindActive = Color3.fromRGB(255, 230, 130),
    },
    ["Strawberry"] = {
        Name = "Strawberry",
        TitleGlow1 = Color3.fromRGB(255, 255, 255),
        TitleGlow2 = Color3.fromRGB(220, 80, 100),
        Background = Color3.fromRGB(35, 22, 25),
        BackgroundDark = Color3.fromRGB(28, 18, 20),
        BackgroundLight = Color3.fromRGB(50, 32, 38),
        Accent = Color3.fromRGB(220, 80, 100),
        AccentLight = Color3.fromRGB(250, 120, 140),
        AccentDark = Color3.fromRGB(180, 60, 80),
        AccentGlow = Color3.fromRGB(240, 100, 120),
        PastelMain = Color3.fromRGB(255, 180, 190),
        PastelCream = Color3.fromRGB(255, 245, 248),
        Border = Color3.fromRGB(80, 50, 58),
        BorderHover = Color3.fromRGB(220, 80, 100),
        Text = Color3.fromRGB(255, 248, 250),
        TextDark = Color3.fromRGB(210, 180, 190),
        TextDisabled = Color3.fromRGB(120, 95, 105),
        Glow = Color3.fromRGB(220, 80, 100),
        GlowTransparency = 0.85,
        Toggle = Color3.fromRGB(220, 80, 100),
        ToggleOff = Color3.fromRGB(75, 48, 55),
        Dropdown = Color3.fromRGB(42, 28, 32),
        Notification = Color3.fromRGB(35, 22, 25),
        KeybindActive = Color3.fromRGB(255, 160, 180),
    },
    ["Dark Chocolate"] = {
        Name = "Dark Chocolate",
        TitleGlow1 = Color3.fromRGB(255, 255, 255),
        TitleGlow2 = Color3.fromRGB(100, 65, 45),
        Background = Color3.fromRGB(22, 18, 15),
        BackgroundDark = Color3.fromRGB(15, 12, 10),
        BackgroundLight = Color3.fromRGB(35, 28, 24),
        Accent = Color3.fromRGB(130, 85, 55),
        AccentLight = Color3.fromRGB(170, 120, 85),
        AccentDark = Color3.fromRGB(100, 60, 40),
        AccentGlow = Color3.fromRGB(150, 100, 70),
        PastelMain = Color3.fromRGB(190, 150, 125),
        PastelCream = Color3.fromRGB(240, 230, 220),
        Border = Color3.fromRGB(60, 48, 40),
        BorderHover = Color3.fromRGB(130, 85, 55),
        Text = Color3.fromRGB(240, 230, 220),
        TextDark = Color3.fromRGB(180, 165, 150),
        TextDisabled = Color3.fromRGB(100, 90, 80),
        Glow = Color3.fromRGB(130, 85, 55),
        GlowTransparency = 0.85,
        Toggle = Color3.fromRGB(130, 85, 55),
        ToggleOff = Color3.fromRGB(55, 45, 38),
        Dropdown = Color3.fromRGB(30, 24, 20),
        Notification = Color3.fromRGB(22, 18, 15),
        KeybindActive = Color3.fromRGB(220, 170, 130),
    },
}

-- Current Theme
local CurrentTheme = Themes["Milk Chocolate"]
local Colors = CurrentTheme

-- Utility Functions
local Utility = {}

function Utility.Create(instanceType, properties)
    local instance = Instance.new(instanceType)
    for prop, value in pairs(properties) do
        if prop ~= "Parent" then
            instance[prop] = value
        end
    end
    if properties.Parent then
        instance.Parent = properties.Parent
    end
    return instance
end

function Utility.Tween(instance, properties, duration, style, direction)
    local tween = TweenService:Create(
        instance,
        TweenInfo.new(duration or 0.2, style or Enum.EasingStyle.Quart, direction or Enum.EasingDirection.Out),
        properties
    )
    tween:Play()
    return tween
end

function Utility.CreateStroke(frame, color, thickness, transparency)
    return Utility.Create("UIStroke", {
        Parent = frame,
        Color = color or Colors.Border,
        Thickness = thickness or 1,
        Transparency = transparency or 0,
    })
end

function Utility.CreateGlow(frame, color, size, transparency)
    local glow = Utility.Create("ImageLabel", {
        Name = "Glow",
        Parent = frame,
        BackgroundTransparency = 1,
        Position = UDim2.new(0.5, 0, 0.5, 0),
        AnchorPoint = Vector2.new(0.5, 0.5),
        Size = UDim2.new(1, size or 30, 1, size or 30),
        ZIndex = frame.ZIndex - 1,
        Image = "rbxassetid://5028857084",
        ImageColor3 = color or Colors.Glow,
        ImageTransparency = transparency or Colors.GlowTransparency,
        ScaleType = Enum.ScaleType.Slice,
        SliceCenter = Rect.new(24, 24, 276, 276),
    })
    return glow
end

function Utility.Ripple(button)
    local ripple = Utility.Create("Frame", {
        Parent = button,
        BackgroundColor3 = Colors.AccentLight,
        BackgroundTransparency = 0.7,
        BorderSizePixel = 0,
        Position = UDim2.new(0, 0, 0, 0),
        Size = UDim2.new(1, 0, 1, 0),
        ZIndex = button.ZIndex + 1,
    })
    
    Utility.Tween(ripple, {BackgroundTransparency = 1}, 0.3)
    task.delay(0.3, function()
        ripple:Destroy()
    end)
end

function Utility.GetTextSize(text, font, size)
    return game:GetService("TextService"):GetTextSize(text, size, font, Vector2.new(math.huge, math.huge))
end

function Utility.MakeDraggable(dragElement, targetElement)
    local dragging = false
    local dragStart, startPos
    
    dragElement.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = targetElement.Position
        end
    end)
    
    dragElement.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = false
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            local delta = input.Position - dragStart
            Utility.Tween(targetElement, {
                Position = UDim2.new(
                    startPos.X.Scale,
                    startPos.X.Offset + delta.X,
                    startPos.Y.Scale,
                    startPos.Y.Offset + delta.Y
                )
            }, 0.05)
        end
    end)
end

function Utility.MakeResizable(resizeElement, targetElement, minSize, maxSize)
    local resizing = false
    local resizeStart, startSize
    
    resizeElement.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            resizing = true
            resizeStart = input.Position
            startSize = targetElement.Size
        end
    end)
    
    resizeElement.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            resizing = false
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if resizing and input.UserInputType == Enum.UserInputType.MouseMovement then
            local delta = input.Position - resizeStart
            local newWidth = math.clamp(startSize.X.Offset + delta.X, minSize.X, maxSize.X)
            local newHeight = math.clamp(startSize.Y.Offset + delta.Y, minSize.Y, maxSize.Y)
            
            Utility.Tween(targetElement, {
                Size = UDim2.new(0, newWidth, 0, newHeight)
            }, 0.05)
        end
    end)
end

function Utility.HSVToRGB(h, s, v)
    local r, g, b
    local i = math.floor(h * 6)
    local f = h * 6 - i
    local p = v * (1 - s)
    local q = v * (1 - f * s)
    local t = v * (1 - (1 - f) * s)
    
    i = i % 6
    
    if i == 0 then r, g, b = v, t, p
    elseif i == 1 then r, g, b = q, v, p
    elseif i == 2 then r, g, b = p, v, t
    elseif i == 3 then r, g, b = p, q, v
    elseif i == 4 then r, g, b = t, p, v
    elseif i == 5 then r, g, b = v, p, q
    end
    
    return r, g, b
end

function Utility.RGBToHSV(r, g, b)
    local max, min = math.max(r, g, b), math.min(r, g, b)
    local h, s, v
    v = max
    
    local d = max - min
    if max == 0 then s = 0 else s = d / max end
    
    if max == min then
        h = 0
    else
        if max == r then
            h = (g - b) / d
            if g < b then h = h + 6 end
        elseif max == g then
            h = (b - r) / d + 2
        elseif max == b then
            h = (r - g) / d + 4
        end
        h = h / 6
    end
    
    return h, s, v
end

function Utility.SaveData(key, data)
    if writefile then
        writefile("milk_chocolate_" .. key .. ".json", HttpService:JSONEncode(data))
    end
end

function Utility.LoadData(key)
    if isfile and readfile then
        if isfile("milk_chocolate_" .. key .. ".json") then
            local success, data = pcall(function()
                return HttpService:JSONDecode(readfile("milk_chocolate_" .. key .. ".json"))
            end)
            if success then
                return data
            end
        end
    end
    return nil
end

-- Key System
function MilkChocolate.CreateKeySystem(config)
    local keyConfig = config or {}
    local requiredKey = keyConfig.Key or "milk.test"
    local title = keyConfig.Title or "milk.chocolate"
    
    local savedData = Utility.LoadData("keydata")
    if savedData and savedData.key == requiredKey and savedData.verified then
        return true
    end
    
    local keyGui = Utility.Create("ScreenGui", {
        Name = "MilkChocolateKey",
        Parent = CoreGui,
        ZIndexBehavior = Enum.ZIndexBehavior.Sibling,
        ResetOnSpawn = false,
    })
    
    local blur = Utility.Create("Frame", {
        Parent = keyGui,
        BackgroundColor3 = Color3.new(0, 0, 0),
        BackgroundTransparency = 0.5,
        BorderSizePixel = 0,
        Size = UDim2.new(1, 0, 1, 0),
    })
    
    local mainFrame = Utility.Create("Frame", {
        Parent = keyGui,
        BackgroundColor3 = Colors.Background,
        BorderSizePixel = 0,
        Position = UDim2.new(0.5, -175, 0.5, -120),
        Size = UDim2.new(0, 350, 0, 240),
        ClipsDescendants = true,
    })
    
    Utility.CreateStroke(mainFrame, Colors.Accent, 1)
    Utility.CreateGlow(mainFrame, Colors.AccentGlow, 40, 0.8)
    
    local titleContainer = Utility.Create("Frame", {
        Parent = mainFrame,
        BackgroundColor3 = Colors.BackgroundDark,
        BorderSizePixel = 0,
        Size = UDim2.new(1, 0, 0, 35),
    })
    
    Utility.Create("Frame", {
        Parent = titleContainer,
        BackgroundColor3 = Colors.Accent,
        BorderSizePixel = 0,
        Position = UDim2.new(0, 0, 1, -1),
        Size = UDim2.new(1, 0, 0, 1),
    })
    
    local milkLabel = Utility.Create("TextLabel", {
        Parent = titleContainer,
        BackgroundTransparency = 1,
        Position = UDim2.new(0.5, -50, 0, 0),
        Size = UDim2.new(0, 35, 1, 0),
        Font = Enum.Font.GothamBold,
        Text = "milk",
        TextColor3 = Colors.TitleGlow1,
        TextSize = 16,
        TextXAlignment = Enum.TextXAlignment.Right,
    })
    
    local chocolateLabel = Utility.Create("TextLabel", {
        Parent = titleContainer,
        BackgroundTransparency = 1,
        Position = UDim2.new(0.5, -15, 0, 0),
        Size = UDim2.new(0, 80, 1, 0),
        Font = Enum.Font.GothamBold,
        Text = ".chocolate",
        TextColor3 = Colors.TitleGlow2,
        TextSize = 16,
        TextXAlignment = Enum.TextXAlignment.Left,
    })
    
    local iconLabel = Utility.Create("TextLabel", {
        Parent = mainFrame,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 0, 0, 50),
        Size = UDim2.new(1, 0, 0, 40),
        Font = Enum.Font.GothamBold,
        Text = "ðŸ”’",
        TextColor3 = Colors.Accent,
        TextSize = 32,
    })
    
    local subtitleLabel = Utility.Create("TextLabel", {
        Parent = mainFrame,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 0, 0, 95),
        Size = UDim2.new(1, 0, 0, 20),
        Font = Enum.Font.Gotham,
        Text = "Enter your key to continue",
        TextColor3 = Colors.TextDark,
        TextSize = 12,
    })
    
    local keyInput = Utility.Create("TextBox", {
        Parent = mainFrame,
        BackgroundColor3 = Colors.Dropdown,
        BorderSizePixel = 0,
        Position = UDim2.new(0.5, -125, 0, 125),
        Size = UDim2.new(0, 250, 0, 32),
        Font = Enum.Font.Gotham,
        PlaceholderText = "Enter key here...",
        PlaceholderColor3 = Colors.TextDisabled,
        Text = "",
        TextColor3 = Colors.Text,
        TextSize = 12,
        ClearTextOnFocus = false,
    })
    
    Utility.Create("UIPadding", {
        Parent = keyInput,
        PaddingLeft = UDim.new(0, 10),
        PaddingRight = UDim.new(0, 10),
    })
    
    local inputStroke = Utility.CreateStroke(keyInput, Colors.Border, 1)
    
    keyInput.Focused:Connect(function()
        Utility.Tween(inputStroke, {Color = Colors.Accent}, 0.2)
    end)
    
    keyInput.FocusLost:Connect(function()
        Utility.Tween(inputStroke, {Color = Colors.Border}, 0.2)
    end)
    
    local submitButton = Utility.Create("TextButton", {
        Parent = mainFrame,
        BackgroundColor3 = Colors.Accent,
        BorderSizePixel = 0,
        Position = UDim2.new(0.5, -60, 0, 170),
        Size = UDim2.new(0, 120, 0, 30),
        Font = Enum.Font.GothamBold,
        Text = "Submit",
        TextColor3 = Colors.PastelCream,
        TextSize = 12,
        AutoButtonColor = false,
    })
    
    Utility.CreateStroke(submitButton, Colors.AccentDark, 1)
    
    local statusLabel = Utility.Create("TextLabel", {
        Parent = mainFrame,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 0, 0, 205),
        Size = UDim2.new(1, 0, 0, 20),
        Font = Enum.Font.Gotham,
        Text = "",
        TextColor3 = Color3.fromRGB(255, 100, 100),
        TextSize = 11,
    })
    
    submitButton.MouseEnter:Connect(function()
        Utility.Tween(submitButton, {BackgroundColor3 = Colors.AccentLight}, 0.15)
    end)
    
    submitButton.MouseLeave:Connect(function()
        Utility.Tween(submitButton, {BackgroundColor3 = Colors.Accent}, 0.15)
    end)
    
    local verified = false
    
    submitButton.MouseButton1Click:Connect(function()
        Utility.Ripple(submitButton)
        
        if keyInput.Text == requiredKey then
            statusLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
            statusLabel.Text = "âœ“ Key verified! Loading..."
            
            Utility.SaveData("keydata", {key = requiredKey, verified = true})
            
            verified = true
            task.wait(1)
            keyGui:Destroy()
        else
            statusLabel.TextColor3 = Color3.fromRGB(255, 100, 100)
            statusLabel.Text = "âœ— Invalid key!"
            
            Utility.Tween(mainFrame, {Position = UDim2.new(0.5, -180, 0.5, -120)}, 0.05)
            task.wait(0.05)
            Utility.Tween(mainFrame, {Position = UDim2.new(0.5, -170, 0.5, -120)}, 0.05)
            task.wait(0.05)
            Utility.Tween(mainFrame, {Position = UDim2.new(0.5, -175, 0.5, -120)}, 0.05)
        end
    end)
    
    while not verified and keyGui.Parent do
        task.wait()
    end
    
    return verified
end

-- Main Library
function MilkChocolate.new(config)
    config = config or {}
    
    if config.KeySystem then
        local passed = MilkChocolate.CreateKeySystem({
            Key = config.Key or "milk.test",
            Title = config.Title
        })
        if not passed then
            return nil
        end
    end
    
    local self = setmetatable({}, MilkChocolate)
    
    self.Title = config.Title or "milk.chocolate"
    self.Size = config.Size or UDim2.new(0, 600, 0, 420)
    self.MinSize = {X = 400, Y = 300}
    self.MaxSize = {X = 900, Y = 700}
    self.Tabs = {}
    self.ActiveTab = nil
    self.Keybinds = {}
    self.KeybindWidgetEntries = {}
    self.KeybindStates = {}
    self.Flags = {}
    self.ToggleKey = config.ToggleKey or Enum.KeyCode.RightShift
    self.Notifications = {}
    self.CurrentTheme = config.Theme or "Milk Chocolate"
    self.ThemeObjects = {}
    
    self:SetTheme(self.CurrentTheme)
    
    self:CreateGui()
    self:CreateWatermark()
    self:CreateKeybindWidget()
    self:CreateNotificationContainer()
    self:SetupInput()
    
    return self
end

function MilkChocolate:RegisterThemeObject(object, properties)
    table.insert(self.ThemeObjects, {Object = object, Properties = properties})
end

function MilkChocolate:SetTheme(themeName)
    if Themes[themeName] then
        CurrentTheme = Themes[themeName]
        Colors = CurrentTheme
        self.CurrentTheme = themeName
        
        self:UpdateAllThemeColors()
    end
end

function MilkChocolate:UpdateAllThemeColors()
    -- Update registered theme objects
    for _, entry in ipairs(self.ThemeObjects) do
        if entry.Object and entry.Object.Parent then
            local props = {}
            for prop, colorKey in pairs(entry.Properties) do
                if Colors[colorKey] then
                    props[prop] = Colors[colorKey]
                end
            end
            if next(props) then
                Utility.Tween(entry.Object, props, 0.3)
            end
        end
    end
    
    -- Update main UI elements
    if self.MainFrame then
        Utility.Tween(self.MainFrame, {BackgroundColor3 = Colors.Background}, 0.3)
    end
    if self.MainStroke then
        Utility.Tween(self.MainStroke, {Color = Colors.Accent}, 0.3)
    end
    if self.MainGlow then
        Utility.Tween(self.MainGlow, {ImageColor3 = Colors.AccentGlow, ImageTransparency = Colors.GlowTransparency}, 0.3)
    end
    if self.TitleBar then
        Utility.Tween(self.TitleBar, {BackgroundColor3 = Colors.BackgroundDark}, 0.3)
    end
    if self.MilkLabel then
        Utility.Tween(self.MilkLabel, {TextColor3 = Colors.TitleGlow1}, 0.3)
    end
    if self.ChocolateLabel then
        Utility.Tween(self.ChocolateLabel, {TextColor3 = Colors.TitleGlow2}, 0.3)
    end
    if self.TabContainer then
        Utility.Tween(self.TabContainer, {BackgroundColor3 = Colors.BackgroundDark}, 0.3)
    end
    if self.ContentContainer then
        Utility.Tween(self.ContentContainer, {BackgroundColor3 = Colors.Background}, 0.3)
    end
    if self.TitleSeparator then
        Utility.Tween(self.TitleSeparator, {BackgroundColor3 = Colors.Accent}, 0.3)
    end
    if self.TabSeparator then
        Utility.Tween(self.TabSeparator, {BackgroundColor3 = Colors.Border}, 0.3)
    end
    
    -- Update resize handle
    if self.ResizeHandle then
        for _, line in pairs(self.ResizeHandle:GetChildren()) do
            if line:IsA("Frame") then
                Utility.Tween(line, {BackgroundColor3 = Colors.TextDark}, 0.3)
            end
        end
    end
    
    -- Update watermark
    if self.Watermark then
        Utility.Tween(self.Watermark, {BackgroundColor3 = Colors.Background}, 0.3)
    end
    if self.WatermarkStroke then
        Utility.Tween(self.WatermarkStroke, {Color = Colors.Accent}, 0.3)
    end
    if self.WatermarkGlow then
        Utility.Tween(self.WatermarkGlow, {ImageColor3 = Colors.AccentGlow, ImageTransparency = Colors.GlowTransparency}, 0.3)
    end
    if self.WatermarkMilk then
        Utility.Tween(self.WatermarkMilk, {TextColor3 = Colors.TitleGlow1}, 0.3)
    end
    if self.WatermarkChocolate then
        Utility.Tween(self.WatermarkChocolate, {TextColor3 = Colors.TitleGlow2}, 0.3)
    end
    if self.WatermarkStats then
        Utility.Tween(self.WatermarkStats, {TextColor3 = Colors.Text}, 0.3)
    end
    
    -- Update keybind widget
    if self.KeybindWidget then
        Utility.Tween(self.KeybindWidget, {BackgroundColor3 = Colors.Background}, 0.3)
    end
    if self.KeybindWidgetStroke then
        Utility.Tween(self.KeybindWidgetStroke, {Color = Colors.Accent}, 0.3)
    end
    if self.KeybindWidgetGlow then
        Utility.Tween(self.KeybindWidgetGlow, {ImageColor3 = Colors.AccentGlow, ImageTransparency = Colors.GlowTransparency}, 0.3)
    end
    if self.KeybindSeparator then
        Utility.Tween(self.KeybindSeparator, {BackgroundColor3 = Colors.Accent}, 0.3)
    end
    if self.KeybindTitleLabel then
        Utility.Tween(self.KeybindTitleLabel, {TextColor3 = Colors.Text}, 0.3)
    end
    
    -- Update keybind entries
    for name, entry in pairs(self.KeybindWidgetEntries) do
        if entry.NameLabel then
            local isActive = self.KeybindStates[name] or false
            Utility.Tween(entry.NameLabel, {TextColor3 = isActive and Colors.KeybindActive or Colors.Text}, 0.3)
        end
        if entry.KeyLabel then
            Utility.Tween(entry.KeyLabel, {TextColor3 = Colors.Accent}, 0.3)
        end
        if entry.ModeLabel then
            Utility.Tween(entry.ModeLabel, {TextColor3 = Colors.TextDark}, 0.3)
        end
    end
    
    -- Update tabs
    for _, tab in ipairs(self.Tabs) do
        if tab.Button then
            if self.ActiveTab == tab then
                Utility.Tween(tab.Button, {BackgroundColor3 = Colors.BackgroundLight}, 0.3)
                Utility.Tween(tab.ButtonLabel, {TextColor3 = Colors.Text}, 0.3)
                if tab.Stroke then
                    Utility.Tween(tab.Stroke, {Color = Colors.Accent, Transparency = 0}, 0.3)
                end
            else
                Utility.Tween(tab.Button, {BackgroundColor3 = Colors.BackgroundDark, BackgroundTransparency = 1}, 0.3)
                Utility.Tween(tab.ButtonLabel, {TextColor3 = Colors.TextDark}, 0.3)
                if tab.Stroke then
                    Utility.Tween(tab.Stroke, {Color = Colors.Border, Transparency = 1}, 0.3)
                end
            end
        end
        if tab.Content then
            Utility.Tween(tab.Content, {ScrollBarImageColor3 = Colors.Accent}, 0.3)
        end
        
        -- Update sections
        for _, section in ipairs(tab.Sections or {}) do
            if section.Frame then
                Utility.Tween(section.Frame, {BackgroundColor3 = Colors.BackgroundDark}, 0.3)
            end
            if section.Stroke then
                Utility.Tween(section.Stroke, {Color = Colors.Border}, 0.3)
            end
            if section.Title then
                Utility.Tween(section.Title, {TextColor3 = Colors.Text}, 0.3)
            end
            if section.TitleContainer then
                for _, child in pairs(section.TitleContainer:GetChildren()) do
                    if child:IsA("Frame") and child.Name == "Separator" then
                        Utility.Tween(child, {BackgroundColor3 = Colors.Accent}, 0.3)
                    end
                end
            end
            if section.SectionGlow then
                Utility.Tween(section.SectionGlow, {ImageColor3 = Colors.AccentGlow, ImageTransparency = Colors.GlowTransparency + 0.05}, 0.3)
            end
        end
    end
end

function MilkChocolate:CreateGui()
    self.ScreenGui = Utility.Create("ScreenGui", {
        Name = "MilkChocolate",
        Parent = CoreGui,
        ZIndexBehavior = Enum.ZIndexBehavior.Sibling,
        ResetOnSpawn = false,
    })
    
    self.MainFrame = Utility.Create("Frame", {
        Name = "Main",
        Parent = self.ScreenGui,
        BackgroundColor3 = Colors.Background,
        BorderSizePixel = 0,
        Position = UDim2.new(0.5, -self.Size.X.Offset/2, 0.5, -self.Size.Y.Offset/2),
        Size = self.Size,
        ClipsDescendants = true,
    })
    
    self.MainStroke = Utility.CreateStroke(self.MainFrame, Colors.Accent, 1)
    self.MainGlow = Utility.CreateGlow(self.MainFrame, Colors.AccentGlow, 50, Colors.GlowTransparency)
    
    -- Title Bar
    self.TitleBar = Utility.Create("Frame", {
        Name = "TitleBar",
        Parent = self.MainFrame,
        BackgroundColor3 = Colors.BackgroundDark,
        BorderSizePixel = 0,
        Size = UDim2.new(1, 0, 0, 32),
    })
    
    local titleX = 10
    
    self.MilkLabel = Utility.Create("TextLabel", {
        Name = "MilkTitle",
        Parent = self.TitleBar,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, titleX, 0, 0),
        Size = UDim2.new(0, 30, 1, 0),
        Font = Enum.Font.GothamBold,
        Text = "milk",
        TextColor3 = Colors.TitleGlow1,
        TextSize = 14,
        TextXAlignment = Enum.TextXAlignment.Left,
    })
    
    self.ChocolateLabel = Utility.Create("TextLabel", {
        Name = "ChocolateTitle",
        Parent = self.TitleBar,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, titleX + 30, 0, 0),
        Size = UDim2.new(0, 70, 1, 0),
        Font = Enum.Font.GothamBold,
        Text = ".chocolate",
        TextColor3 = Colors.TitleGlow2,
        TextSize = 14,
        TextXAlignment = Enum.TextXAlignment.Left,
    })
    
    self.TitleSeparator = Utility.Create("Frame", {
        Name = "Separator",
        Parent = self.TitleBar,
        BackgroundColor3 = Colors.Accent,
        BorderSizePixel = 0,
        Position = UDim2.new(0, 0, 1, -1),
        Size = UDim2.new(1, 0, 0, 1),
    })
    
    -- Resize Handle with visible lines
    self.ResizeHandle = Utility.Create("Frame", {
        Name = "ResizeHandle",
        Parent = self.MainFrame,
        BackgroundTransparency = 1,
        Position = UDim2.new(1, -20, 1, -20),
        Size = UDim2.new(0, 18, 0, 18),
        ZIndex = 10,
    })
    
    -- Create 3 diagonal lines for resize indicator
    for i = 1, 3 do
        local offset = (i - 1) * 5
        Utility.Create("Frame", {
            Name = "Line" .. i,
            Parent = self.ResizeHandle,
            BackgroundColor3 = Colors.TextDark,
            BorderSizePixel = 0,
            Position = UDim2.new(0, 2 + offset, 1, -4 - offset),
            Size = UDim2.new(0, 12 - offset, 0, 2),
            Rotation = -45,
            ZIndex = 10,
        })
    end
    
    Utility.MakeResizable(self.ResizeHandle, self.MainFrame, self.MinSize, self.MaxSize)
    
    self.ResizeHandle.MouseEnter:Connect(function()
        for _, line in pairs(self.ResizeHandle:GetChildren()) do
            if line:IsA("Frame") then
                Utility.Tween(line, {BackgroundColor3 = Colors.Accent}, 0.15)
            end
        end
    end)
    
    self.ResizeHandle.MouseLeave:Connect(function()
        for _, line in pairs(self.ResizeHandle:GetChildren()) do
            if line:IsA("Frame") then
                Utility.Tween(line, {BackgroundColor3 = Colors.TextDark}, 0.15)
            end
        end
    end)
    
    -- Tab Container
    self.TabContainer = Utility.Create("Frame", {
        Name = "TabContainer",
        Parent = self.MainFrame,
        BackgroundColor3 = Colors.BackgroundDark,
        BorderSizePixel = 0,
        Position = UDim2.new(0, 0, 0, 32),
        Size = UDim2.new(1, 0, 0, 28),
    })
    
    self.TabSeparator = Utility.Create("Frame", {
        Name = "Separator",
        Parent = self.TabContainer,
        BackgroundColor3 = Colors.Border,
        BorderSizePixel = 0,
        Position = UDim2.new(0, 0, 1, -1),
        Size = UDim2.new(1, 0, 0, 1),
    })
    
    self.TabList = Utility.Create("Frame", {
        Name = "TabList",
        Parent = self.TabContainer,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 5, 0, 0),
        Size = UDim2.new(1, -10, 1, 0),
    })
    
    Utility.Create("UIListLayout", {
        Parent = self.TabList,
        FillDirection = Enum.FillDirection.Horizontal,
        SortOrder = Enum.SortOrder.LayoutOrder,
        Padding = UDim.new(0, 5),
    })
    
    -- Content Container
    self.ContentContainer = Utility.Create("Frame", {
        Name = "ContentContainer",
        Parent = self.MainFrame,
        BackgroundColor3 = Colors.Background,
        BorderSizePixel = 0,
        Position = UDim2.new(0, 0, 0, 60),
        Size = UDim2.new(1, 0, 1, -60),
    })
    
    Utility.MakeDraggable(self.TitleBar, self.MainFrame)
end

function MilkChocolate:CreateWatermark()
    self.Watermark = Utility.Create("Frame", {
        Name = "Watermark",
        Parent = self.ScreenGui,
        BackgroundColor3 = Colors.Background,
        BorderSizePixel = 0,
        Position = UDim2.new(1, -10, 0, 10),
        AnchorPoint = Vector2.new(1, 0),
        Size = UDim2.new(0, 250, 0, 26),
        ClipsDescendants = false,
    })
    
    self.WatermarkStroke = Utility.CreateStroke(self.Watermark, Colors.Accent, 1)
    self.WatermarkGlow = Utility.CreateGlow(self.Watermark, Colors.AccentGlow, 25, Colors.GlowTransparency)
    
    self.WatermarkMilk = Utility.Create("TextLabel", {
        Name = "Milk",
        Parent = self.Watermark,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 8, 0, 0),
        Size = UDim2.new(0, 25, 1, 0),
        Font = Enum.Font.GothamBold,
        Text = "milk",
        TextColor3 = Colors.TitleGlow1,
        TextSize = 11,
        TextXAlignment = Enum.TextXAlignment.Left,
    })
    
    self.WatermarkChocolate = Utility.Create("TextLabel", {
        Name = "Chocolate",
        Parent = self.Watermark,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 33, 0, 0),
        Size = UDim2.new(0, 60, 1, 0),
        Font = Enum.Font.GothamBold,
        Text = ".chocolate",
        TextColor3 = Colors.TitleGlow2,
        TextSize = 11,
        TextXAlignment = Enum.TextXAlignment.Left,
    })
    
    self.WatermarkStats = Utility.Create("TextLabel", {
        Name = "Stats",
        Parent = self.Watermark,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 98, 0, 0),
        Size = UDim2.new(1, -106, 1, 0),
        Font = Enum.Font.Gotham,
        Text = "| FPS: -- | Ping: -- | --:--:--",
        TextColor3 = Colors.Text,
        TextSize = 11,
        TextXAlignment = Enum.TextXAlignment.Left,
    })
    
    Utility.MakeDraggable(self.Watermark, self.Watermark)
    
    RunService.RenderStepped:Connect(function()
        local fps = math.floor(1 / RunService.RenderStepped:Wait())
        local ping = math.floor(Player:GetNetworkPing() * 1000)
        local time = os.date("%H:%M:%S")
        
        local text = string.format("| FPS: %d | Ping: %dms | %s", fps, ping, time)
        self.WatermarkStats.Text = text
        
        local totalWidth = 98 + Utility.GetTextSize(text, Enum.Font.Gotham, 11).X + 10
        Utility.Tween(self.Watermark, {Size = UDim2.new(0, totalWidth, 0, 26)}, 0.1)
    end)
end

function MilkChocolate:CreateKeybindWidget()
    self.KeybindWidget = Utility.Create("Frame", {
        Name = "KeybindWidget",
        Parent = self.ScreenGui,
        BackgroundColor3 = Colors.Background,
        BorderSizePixel = 0,
        Position = UDim2.new(1, -10, 0, 46),
        AnchorPoint = Vector2.new(1, 0),
        Size = UDim2.new(0, 200, 0, 28),
        ClipsDescendants = true,
    })
    
    self.KeybindWidgetStroke = Utility.CreateStroke(self.KeybindWidget, Colors.Accent, 1)
    self.KeybindWidgetGlow = Utility.CreateGlow(self.KeybindWidget, Colors.AccentGlow, 25, Colors.GlowTransparency)
    
    self.KeybindWidgetTitle = Utility.Create("Frame", {
        Name = "TitleArea",
        Parent = self.KeybindWidget,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 20),
    })
    
    self.KeybindTitleLabel = Utility.Create("TextLabel", {
        Name = "Title",
        Parent = self.KeybindWidgetTitle,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 8, 0, 2),
        Size = UDim2.new(1, -16, 0, 16),
        Font = Enum.Font.GothamBold,
        Text = "Keybinds",
        TextColor3 = Colors.Text,
        TextSize = 10,
        TextXAlignment = Enum.TextXAlignment.Left,
    })
    
    self.KeybindSeparator = Utility.Create("Frame", {
        Name = "Separator",
        Parent = self.KeybindWidget,
        BackgroundColor3 = Colors.Accent,
        BorderSizePixel = 0,
        Position = UDim2.new(0, 8, 0, 22),
        Size = UDim2.new(1, -16, 0, 1),
    })
    
    Utility.MakeDraggable(self.KeybindWidgetTitle, self.KeybindWidget)
    
    self.KeybindList = Utility.Create("Frame", {
        Name = "KeybindList",
        Parent = self.KeybindWidget,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 0, 0, 26),
        Size = UDim2.new(1, 0, 0, 0),
        AutomaticSize = Enum.AutomaticSize.Y,
    })
    
    Utility.Create("UIListLayout", {
        Parent = self.KeybindList,
        SortOrder = Enum.SortOrder.LayoutOrder,
        Padding = UDim.new(0, 2),
    })
    
    Utility.Create("UIPadding", {
        Parent = self.KeybindList,
        PaddingBottom = UDim.new(0, 5),
    })
    
    self:UpdateKeybindWidgetSize()
end

function MilkChocolate:UpdateKeybindWidgetSize()
    local count = 0
    for _, child in pairs(self.KeybindList:GetChildren()) do
        if child:IsA("Frame") then
            count = count + 1
        end
    end
    
    local height = 28 + (count * 18)
    if count == 0 then
        height = 28
    end
    
    Utility.Tween(self.KeybindWidget, {Size = UDim2.new(0, 200, 0, height)}, 0.2)
end

function MilkChocolate:AddKeybindToWidget(name, key, mode)
    if key == Enum.KeyCode.Backspace or key == Enum.KeyCode.Unknown then
        return nil, nil
    end
    
    local keybindFrame = Utility.Create("Frame", {
        Name = name,
        Parent = self.KeybindList,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 16),
    })
    
    local nameLabel = Utility.Create("TextLabel", {
        Name = "Name",
        Parent = keybindFrame,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 8, 0, 0),
        Size = UDim2.new(0, 80, 1, 0),
        Font = Enum.Font.Gotham,
        Text = name,
        TextColor3 = Colors.Text,
        TextSize = 10,
        TextXAlignment = Enum.TextXAlignment.Left,
        TextTruncate = Enum.TextTruncate.AtEnd,
    })
    
    local modeLabel = Utility.Create("TextLabel", {
        Name = "Mode",
        Parent = keybindFrame,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 90, 0, 0),
        Size = UDim2.new(0, 45, 1, 0),
        Font = Enum.Font.Gotham,
        Text = "[" .. (mode or "Hold") .. "]",
        TextColor3 = Colors.TextDark,
        TextSize = 9,
        TextXAlignment = Enum.TextXAlignment.Left,
    })
    
    local keyLabel = Utility.Create("TextLabel", {
        Name = "Key",
        Parent = keybindFrame,
        BackgroundTransparency = 1,
        Position = UDim2.new(1, -50, 0, 0),
        Size = UDim2.new(0, 42, 1, 0),
        Font = Enum.Font.GothamBold,
        Text = "[" .. key.Name .. "]",
        TextColor3 = Colors.Accent,
        TextSize = 10,
        TextXAlignment = Enum.TextXAlignment.Right,
    })
    
    self.KeybindWidgetEntries[name] = {
        Frame = keybindFrame,
        NameLabel = nameLabel,
        KeyLabel = keyLabel,
        ModeLabel = modeLabel
    }
    self.KeybindStates[name] = false
    
    self:UpdateKeybindWidgetSize()
    
    return keybindFrame, keyLabel
end

function MilkChocolate:SetKeybindState(name, isActive)
    self.KeybindStates[name] = isActive
    
    local entry = self.KeybindWidgetEntries[name]
    if entry and entry.NameLabel then
        Utility.Tween(entry.NameLabel, {
            TextColor3 = isActive and Colors.KeybindActive or Colors.Text
        }, 0.15)
    end
end

function MilkChocolate:RemoveKeybindFromWidget(name)
    local entry = self.KeybindWidgetEntries[name]
    if entry and entry.Frame then
        entry.Frame:Destroy()
    end
    self.KeybindWidgetEntries[name] = nil
    self.KeybindStates[name] = nil
    self:UpdateKeybindWidgetSize()
end

function MilkChocolate:UpdateKeybindInWidget(name, key, mode)
    local entry = self.KeybindWidgetEntries[name]
    if entry then
        if entry.KeyLabel then
            entry.KeyLabel.Text = "[" .. key.Name .. "]"
        end
        if entry.ModeLabel then
            entry.ModeLabel.Text = "[" .. mode .. "]"
        end
    end
end

function MilkChocolate:CreateNotificationContainer()
    self.NotificationContainer = Utility.Create("Frame", {
        Name = "Notifications",
        Parent = self.ScreenGui,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 10, 0, 10),
        AnchorPoint = Vector2.new(0, 0),
        Size = UDim2.new(0, 220, 0, 500),
    })
    
    Utility.Create("UIListLayout", {
        Parent = self.NotificationContainer,
        SortOrder = Enum.SortOrder.LayoutOrder,
        VerticalAlignment = Enum.VerticalAlignment.Top,
        Padding = UDim.new(0, 8),
    })
end

function MilkChocolate:Notify(config)
    config = config or {}
    local title = config.Title or "Notification"
    local content = config.Content or ""
    local notifType = config.Type or "Info"
    local duration = config.Duration or 4
    
    local typeColors = {
        Info = Colors.Accent,
        Success = Color3.fromRGB(80, 200, 120),
        Warning = Color3.fromRGB(230, 180, 80),
        Error = Color3.fromRGB(220, 80, 80),
    }
    
    local accentColor = typeColors[notifType] or Colors.Accent
    
    local notification = Utility.Create("Frame", {
        Name = "Notification",
        Parent = self.NotificationContainer,
        BackgroundColor3 = Colors.Background,
        BorderSizePixel = 0,
        Size = UDim2.new(1, 0, 0, 0),
        ClipsDescendants = true,
    })
    
    Utility.CreateStroke(notification, accentColor, 1)
    Utility.CreateGlow(notification, accentColor, 20, 0.85)
    
    Utility.Create("Frame", {
        Name = "AccentLine",
        Parent = notification,
        BackgroundColor3 = accentColor,
        BorderSizePixel = 0,
        Size = UDim2.new(0, 3, 1, 0),
    })
    
    local titleLabel = Utility.Create("TextLabel", {
        Parent = notification,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 12, 0, 8),
        Size = UDim2.new(1, -20, 0, 14),
        Font = Enum.Font.GothamBold,
        Text = title,
        TextColor3 = Colors.Text,
        TextSize = 11,
        TextXAlignment = Enum.TextXAlignment.Left,
    })
    
    local contentLabel = Utility.Create("TextLabel", {
        Parent = notification,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 12, 0, 24),
        Size = UDim2.new(1, -20, 0, 0),
        Font = Enum.Font.Gotham,
        Text = content,
        TextColor3 = Colors.TextDark,
        TextSize = 10,
        TextXAlignment = Enum.TextXAlignment.Left,
        TextYAlignment = Enum.TextYAlignment.Top,
        TextWrapped = true,
        AutomaticSize = Enum.AutomaticSize.Y,
    })
    
    local progressBar = Utility.Create("Frame", {
        Name = "Progress",
        Parent = notification,
        BackgroundColor3 = accentColor,
        BorderSizePixel = 0,
        Position = UDim2.new(0, 0, 1, -2),
        Size = UDim2.new(1, 0, 0, 2),
    })
    
    task.wait()
    local height = 38 + contentLabel.AbsoluteSize.Y
    height = math.clamp(height, 50, 120)
    
    Utility.Tween(notification, {Size = UDim2.new(1, 0, 0, height)}, 0.3)
    Utility.Tween(progressBar, {Size = UDim2.new(0, 0, 0, 2)}, duration, Enum.EasingStyle.Linear)
    
    task.delay(duration, function()
        Utility.Tween(notification, {Size = UDim2.new(1, 0, 0, 0)}, 0.3)
        task.wait(0.3)
        notification:Destroy()
    end)
    
    return notification
end

function MilkChocolate:SetupInput()
    UserInputService.InputBegan:Connect(function(input, gameProcessed)
        if gameProcessed then return end
        
        if input.KeyCode == self.ToggleKey then
            self.MainFrame.Visible = not self.MainFrame.Visible
        end
    end)
end

function MilkChocolate:Toggle(visible)
    if visible ~= nil then
        self.MainFrame.Visible = visible
    else
        self.MainFrame.Visible = not self.MainFrame.Visible
    end
end

function MilkChocolate:Destroy()
    self.ScreenGui:Destroy()
end

-- Tab Class
local Tab = {}
Tab.__index = Tab

function MilkChocolate:AddTab(config)
    config = config or {}
    
    local tab = setmetatable({}, Tab)
    tab.Name = config.Name or "Tab"
    tab.Library = self
    tab.Sections = {}
    
    tab.Button = Utility.Create("TextButton", {
        Name = tab.Name,
        Parent = self.TabList,
        BackgroundColor3 = Colors.BackgroundLight,
        BackgroundTransparency = 1,
        BorderSizePixel = 0,
        Size = UDim2.new(0, 0, 1, -4),
        AutomaticSize = Enum.AutomaticSize.X,
        Font = Enum.Font.Gotham,
        Text = "",
        AutoButtonColor = false,
    })
    
    Utility.Create("UIPadding", {
        Parent = tab.Button,
        PaddingLeft = UDim.new(0, 12),
        PaddingRight = UDim.new(0, 12),
    })
    
    tab.Stroke = Utility.CreateStroke(tab.Button, Colors.Border, 1, 1)
    
    tab.ButtonLabel = Utility.Create("TextLabel", {
        Parent = tab.Button,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 1, 0),
        Font = Enum.Font.Gotham,
        Text = tab.Name,
        TextColor3 = Colors.TextDark,
        TextSize = 11,
    })
    
    tab.Content = Utility.Create("ScrollingFrame", {
        Name = tab.Name .. "Content",
        Parent = self.ContentContainer,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 5, 0, 5),
        Size = UDim2.new(1, -10, 1, -10),
        ScrollBarThickness = 2,
        ScrollBarImageColor3 = Colors.Accent,
        CanvasSize = UDim2.new(0, 0, 0, 0),
        AutomaticCanvasSize = Enum.AutomaticSize.Y,
        Visible = false,
    })
    
    tab.LeftColumn = Utility.Create("Frame", {
        Name = "LeftColumn",
        Parent = tab.Content,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 0, 0, 0),
        Size = UDim2.new(0.5, -3, 0, 0),
        AutomaticSize = Enum.AutomaticSize.Y,
    })
    
    Utility.Create("UIListLayout", {
        Parent = tab.LeftColumn,
        SortOrder = Enum.SortOrder.LayoutOrder,
        Padding = UDim.new(0, 6),
    })
    
    tab.RightColumn = Utility.Create("Frame", {
        Name = "RightColumn",
        Parent = tab.Content,
        BackgroundTransparency = 1,
        Position = UDim2.new(0.5, 3, 0, 0),
        Size = UDim2.new(0.5, -3, 0, 0),
        AutomaticSize = Enum.AutomaticSize.Y,
    })
    
    Utility.Create("UIListLayout", {
        Parent = tab.RightColumn,
        SortOrder = Enum.SortOrder.LayoutOrder,
        Padding = UDim.new(0, 6),
    })
    
    tab.Button.MouseEnter:Connect(function()
        if self.ActiveTab ~= tab then
            Utility.Tween(tab.Button, {BackgroundTransparency = 0.8, BackgroundColor3 = Colors.BackgroundLight}, 0.15)
            Utility.Tween(tab.Stroke, {Transparency = 0, Color = Colors.BorderHover}, 0.15)
            Utility.Tween(tab.ButtonLabel, {TextColor3 = Colors.Accent}, 0.15)
        end
    end)
    
    tab.Button.MouseLeave:Connect(function()
        if self.ActiveTab ~= tab then
            Utility.Tween(tab.Button, {BackgroundTransparency = 1}, 0.15)
            Utility.Tween(tab.Stroke, {Transparency = 1, Color = Colors.Border}, 0.15)
            Utility.Tween(tab.ButtonLabel, {TextColor3 = Colors.TextDark}, 0.15)
        end
    end)
    
    tab.Button.MouseButton1Click:Connect(function()
        self:SelectTab(tab)
        Utility.Ripple(tab.Button)
    end)
    
    table.insert(self.Tabs, tab)
    
    if #self.Tabs == 1 then
        self:SelectTab(tab)
    end
    
    return tab
end

function MilkChocolate:SelectTab(tab)
    if self.ActiveTab then
        Utility.Tween(self.ActiveTab.Button, {BackgroundTransparency = 1}, 0.2)
        Utility.Tween(self.ActiveTab.Stroke, {Transparency = 1, Color = Colors.Border}, 0.2)
        Utility.Tween(self.ActiveTab.ButtonLabel, {TextColor3 = Colors.TextDark}, 0.2)
        self.ActiveTab.Content.Visible = false
    end
    
    self.ActiveTab = tab
    Utility.Tween(tab.Button, {BackgroundTransparency = 0.7, BackgroundColor3 = Colors.BackgroundLight}, 0.2)
    Utility.Tween(tab.Stroke, {Transparency = 0, Color = Colors.Accent}, 0.2)
    Utility.Tween(tab.ButtonLabel, {TextColor3 = Colors.Text}, 0.2)
    tab.Content.Visible = true
end

-- Section Class
local Section = {}
Section.__index = Section

function Tab:AddSection(config)
    config = config or {}
    
    local section = setmetatable({}, Section)
    section.Name = config.Name or "Section"
    section.Side = config.Side or "Left"
    section.Tab = self
    
    local parent = section.Side == "Left" and self.LeftColumn or self.RightColumn
    
    section.Frame = Utility.Create("Frame", {
        Name = section.Name,
        Parent = parent,
        BackgroundColor3 = Colors.BackgroundDark,
        BorderSizePixel = 0,
        Size = UDim2.new(1, 0, 0, 0),
        AutomaticSize = Enum.AutomaticSize.Y,
        ClipsDescendants = false,
    })
    
    section.Stroke = Utility.CreateStroke(section.Frame, Colors.Border, 1)
    section.SectionGlow = Utility.CreateGlow(section.Frame, Colors.AccentGlow, 20, Colors.GlowTransparency + 0.05)
    
    section.TitleContainer = Utility.Create("Frame", {
        Name = "TitleContainer",
        Parent = section.Frame,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 22),
    })
    
    Utility.Create("Frame", {
        Name = "Separator",
        Parent = section.TitleContainer,
        BackgroundColor3 = Colors.Accent,
        BorderSizePixel = 0,
        Position = UDim2.new(0, 0, 1, -1),
        Size = UDim2.new(1, 0, 0, 1),
    })
    
    section.Title = Utility.Create("TextLabel", {
        Name = "Title",
        Parent = section.TitleContainer,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 8, 0, 0),
        Size = UDim2.new(1, -16, 1, 0),
        Font = Enum.Font.GothamBold,
        Text = section.Name,
        TextColor3 = Colors.Text,
        TextSize = 11,
        TextXAlignment = Enum.TextXAlignment.Left,
    })
    
    section.Content = Utility.Create("Frame", {
        Name = "Content",
        Parent = section.Frame,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 0, 0, 22),
        Size = UDim2.new(1, 0, 0, 0),
        AutomaticSize = Enum.AutomaticSize.Y,
    })
    
    Utility.Create("UIListLayout", {
        Parent = section.Content,
        SortOrder = Enum.SortOrder.LayoutOrder,
        Padding = UDim.new(0, 4),
    })
    
    Utility.Create("UIPadding", {
        Parent = section.Content,
        PaddingTop = UDim.new(0, 5),
        PaddingBottom = UDim.new(0, 8),
        PaddingLeft = UDim.new(0, 8),
        PaddingRight = UDim.new(0, 8),
    })
    
    section.Frame.MouseEnter:Connect(function()
        Utility.Tween(section.Stroke, {Color = Colors.BorderHover}, 0.2)
        Utility.Tween(section.Title, {TextColor3 = Colors.Accent}, 0.2)
        Utility.Tween(section.SectionGlow, {ImageTransparency = Colors.GlowTransparency - 0.1}, 0.2)
    end)
    
    section.Frame.MouseLeave:Connect(function()
        Utility.Tween(section.Stroke, {Color = Colors.Border}, 0.2)
        Utility.Tween(section.Title, {TextColor3 = Colors.Text}, 0.2)
        Utility.Tween(section.SectionGlow, {ImageTransparency = Colors.GlowTransparency + 0.05}, 0.2)
    end)
    
    table.insert(self.Sections, section)
    return section
end

-- UI Elements

function Section:AddButton(config)
    config = config or {}
    local name = config.Name or "Button"
    local callback = config.Callback or function() end
    
    local button = Utility.Create("TextButton", {
        Name = name,
        Parent = self.Content,
        BackgroundColor3 = Colors.BackgroundLight,
        BorderSizePixel = 0,
        Size = UDim2.new(1, 0, 0, 28),
        Font = Enum.Font.Gotham,
        Text = name,
        TextColor3 = Colors.Text,
        TextSize = 11,
        AutoButtonColor = false,
    })
    
    local stroke = Utility.CreateStroke(button, Colors.Border, 1)
    
    self.Tab.Library:RegisterThemeObject(button, {BackgroundColor3 = "BackgroundLight", TextColor3 = "Text"})
    self.Tab.Library:RegisterThemeObject(stroke, {Color = "Border"})
    
    button.MouseEnter:Connect(function()
        Utility.Tween(button, {BackgroundColor3 = Colors.Accent, TextColor3 = Colors.PastelCream}, 0.15)
        Utility.Tween(stroke, {Color = Colors.AccentLight}, 0.15)
    end)
    
    button.MouseLeave:Connect(function()
        Utility.Tween(button, {BackgroundColor3 = Colors.BackgroundLight, TextColor3 = Colors.Text}, 0.15)
        Utility.Tween(stroke, {Color = Colors.Border}, 0.15)
    end)
    
    button.MouseButton1Click:Connect(function()
        Utility.Ripple(button)
        callback()
    end)
    
    return button
end

function Section:AddToggle(config)
    config = config or {}
    local name = config.Name or "Toggle"
    local default = config.Default or false
    local callback = config.Callback or function() end
    local flag = config.Flag
    
    local toggled = default
    
    local container = Utility.Create("Frame", {
        Name = name,
        Parent = self.Content,
        BackgroundColor3 = Colors.BackgroundLight,
        BorderSizePixel = 0,        Size = UDim2.new(1, 0, 0, 28),
    })
    
    local containerStroke = Utility.CreateStroke(container, Colors.Border, 1)
    
    local label = Utility.Create("TextLabel", {
        Parent = container,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 8, 0, 0),
        Size = UDim2.new(1, -40, 1, 0),
        Font = Enum.Font.Gotham,
        Text = name,
        TextColor3 = Colors.Text,
        TextSize = 11,
        TextXAlignment = Enum.TextXAlignment.Left,
        TextTruncate = Enum.TextTruncate.AtEnd,
    })
    
    local toggleBox = Utility.Create("Frame", {
        Name = "ToggleBox",
        Parent = container,
        BackgroundColor3 = toggled and Colors.Toggle or Colors.ToggleOff,
        BorderSizePixel = 0,
        Position = UDim2.new(1, -26, 0.5, -8),
        Size = UDim2.new(0, 18, 0, 16),
    })
    
    local toggleStroke = Utility.CreateStroke(toggleBox, Colors.Border, 1)
    
    local checkmark = Utility.Create("TextLabel", {
        Parent = toggleBox,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 1, 0),
        Font = Enum.Font.GothamBold,
        Text = toggled and "âœ“" or "",
        TextColor3 = Colors.PastelCream,
        TextSize = 12,
    })
    
    local button = Utility.Create("TextButton", {
        Parent = container,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 1, 0),
        Text = "",
    })
    
    self.Tab.Library:RegisterThemeObject(container, {BackgroundColor3 = "BackgroundLight"})
    self.Tab.Library:RegisterThemeObject(containerStroke, {Color = "Border"})
    self.Tab.Library:RegisterThemeObject(label, {TextColor3 = "Text"})
    self.Tab.Library:RegisterThemeObject(toggleStroke, {Color = "Border"})
    self.Tab.Library:RegisterThemeObject(checkmark, {TextColor3 = "PastelCream"})
    
    local function updateToggle()
        Utility.Tween(toggleBox, {BackgroundColor3 = toggled and Colors.Toggle or Colors.ToggleOff}, 0.2)
        checkmark.Text = toggled and "âœ“" or ""
        callback(toggled)
        
        if flag then
            self.Tab.Library.Flags[flag] = toggled
        end
    end
    
    button.MouseButton1Click:Connect(function()
        toggled = not toggled
        updateToggle()
    end)
    
    container.MouseEnter:Connect(function()
        Utility.Tween(container, {BackgroundColor3 = Color3.fromRGB(
            math.min(Colors.BackgroundLight.R * 255 + 15, 255) / 255,
            math.min(Colors.BackgroundLight.G * 255 + 15, 255) / 255,
            math.min(Colors.BackgroundLight.B * 255 + 15, 255) / 255
        )}, 0.15)
        Utility.Tween(label, {TextColor3 = Colors.Accent}, 0.15)
    end)
    
    container.MouseLeave:Connect(function()
        Utility.Tween(container, {BackgroundColor3 = Colors.BackgroundLight}, 0.15)
        Utility.Tween(label, {TextColor3 = Colors.Text}, 0.15)
    end)
    
    if flag then
        self.Tab.Library.Flags[flag] = toggled
    end
    
    updateToggle()
    
    return {
        Set = function(_, value)
            toggled = value
            updateToggle()
        end,
        Get = function()
            return toggled
        end
    }
end

function Section:AddSlider(config)
    config = config or {}
    local name = config.Name or "Slider"
    local min = config.Min or 0
    local max = config.Max or 100
    local default = config.Default or min
    local increment = config.Increment or 1
    local callback = config.Callback or function() end
    local flag = config.Flag
    local suffix = config.Suffix or ""
    
    local value = default
    
    local container = Utility.Create("Frame", {
        Name = name,
        Parent = self.Content,
        BackgroundColor3 = Colors.BackgroundLight,
        BorderSizePixel = 0,
        Size = UDim2.new(1, 0, 0, 40),
    })
    
    local containerStroke = Utility.CreateStroke(container, Colors.Border, 1)
    
    local label = Utility.Create("TextLabel", {
        Parent = container,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 8, 0, 2),
        Size = UDim2.new(1, -65, 0, 16),
        Font = Enum.Font.Gotham,
        Text = name,
        TextColor3 = Colors.Text,
        TextSize = 11,
        TextXAlignment = Enum.TextXAlignment.Left,
        TextTruncate = Enum.TextTruncate.AtEnd,
    })
    
    local valueLabel = Utility.Create("TextLabel", {
        Parent = container,
        BackgroundTransparency = 1,
        Position = UDim2.new(1, -60, 0, 2),
        Size = UDim2.new(0, 52, 0, 16),
        Font = Enum.Font.GothamBold,
        Text = tostring(value) .. suffix,
        TextColor3 = Colors.Accent,
        TextSize = 11,
        TextXAlignment = Enum.TextXAlignment.Right,
    })
    
    local sliderBg = Utility.Create("Frame", {
        Name = "SliderBg",
        Parent = container,
        BackgroundColor3 = Colors.ToggleOff,
        BorderSizePixel = 0,
        Position = UDim2.new(0, 8, 0, 24),
        Size = UDim2.new(1, -16, 0, 8),
    })
    
    Utility.Create("UICorner", {
        Parent = sliderBg,
        CornerRadius = UDim.new(0, 4),
    })
    
    local sliderFill = Utility.Create("Frame", {
        Name = "Fill",
        Parent = sliderBg,
        BackgroundColor3 = Colors.Accent,
        BorderSizePixel = 0,
        Size = UDim2.new((value - min) / (max - min), 0, 1, 0),
    })
    
    Utility.Create("UICorner", {
        Parent = sliderFill,
        CornerRadius = UDim.new(0, 4),
    })
    
    self.Tab.Library:RegisterThemeObject(container, {BackgroundColor3 = "BackgroundLight"})
    self.Tab.Library:RegisterThemeObject(containerStroke, {Color = "Border"})
    self.Tab.Library:RegisterThemeObject(label, {TextColor3 = "Text"})
    self.Tab.Library:RegisterThemeObject(valueLabel, {TextColor3 = "Accent"})
    self.Tab.Library:RegisterThemeObject(sliderBg, {BackgroundColor3 = "ToggleOff"})
    self.Tab.Library:RegisterThemeObject(sliderFill, {BackgroundColor3 = "Accent"})
    
    local dragging = false
    
    local function updateSlider(input)
        local pos = UDim2.new(math.clamp((input.Position.X - sliderBg.AbsolutePosition.X) / sliderBg.AbsoluteSize.X, 0, 1), 0, 1, 0)
        sliderFill.Size = pos
        
        local rawValue = min + ((max - min) * pos.X.Scale)
        value = math.floor(rawValue / increment + 0.5) * increment
        value = math.clamp(value, min, max)
        
        valueLabel.Text = tostring(value) .. suffix
        callback(value)
        
        if flag then
            self.Tab.Library.Flags[flag] = value
        end
    end
    
    sliderBg.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            updateSlider(input)
        end
    end)
    
    sliderBg.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = false
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            updateSlider(input)
        end
    end)
    
    container.MouseEnter:Connect(function()
        Utility.Tween(label, {TextColor3 = Colors.Accent}, 0.15)
    end)
    
    container.MouseLeave:Connect(function()
        Utility.Tween(label, {TextColor3 = Colors.Text}, 0.15)
    end)
    
    if flag then
        self.Tab.Library.Flags[flag] = value
    end
    
    return {
        Set = function(_, newValue)
            value = math.clamp(newValue, min, max)
            sliderFill.Size = UDim2.new((value - min) / (max - min), 0, 1, 0)
            valueLabel.Text = tostring(value) .. suffix
            callback(value)
        end,
        Get = function()
            return value
        end
    }
end

function Section:AddDropdown(config)
    config = config or {}
    local name = config.Name or "Dropdown"
    local options = config.Options or {}
    local default = config.Default
    local callback = config.Callback or function() end
    local flag = config.Flag
    
    local selected = default or (options[1] or "")
    local opened = false
    
    local container = Utility.Create("Frame", {
        Name = name,
        Parent = self.Content,
        BackgroundColor3 = Colors.BackgroundLight,
        BorderSizePixel = 0,
        Size = UDim2.new(1, 0, 0, 50),
        ClipsDescendants = true,
    })
    
    local containerStroke = Utility.CreateStroke(container, Colors.Border, 1)
    
    local label = Utility.Create("TextLabel", {
        Parent = container,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 8, 0, 2),
        Size = UDim2.new(1, -16, 0, 16),
        Font = Enum.Font.Gotham,
        Text = name,
        TextColor3 = Colors.Text,
        TextSize = 11,
        TextXAlignment = Enum.TextXAlignment.Left,
    })
    
    local dropdownButton = Utility.Create("TextButton", {
        Name = "DropdownButton",
        Parent = container,
        BackgroundColor3 = Colors.Dropdown,
        BorderSizePixel = 0,
        Position = UDim2.new(0, 8, 0, 20),
        Size = UDim2.new(1, -16, 0, 24),
        Font = Enum.Font.Gotham,
        Text = "  " .. tostring(selected),
        TextColor3 = Colors.Text,
        TextSize = 11,
        TextXAlignment = Enum.TextXAlignment.Left,
        AutoButtonColor = false,
    })
    
    local dropdownStroke = Utility.CreateStroke(dropdownButton, Colors.Border, 1)
    
    local arrow = Utility.Create("TextLabel", {
        Parent = dropdownButton,
        BackgroundTransparency = 1,
        Position = UDim2.new(1, -20, 0, 0),
        Size = UDim2.new(0, 20, 1, 0),
        Font = Enum.Font.GothamBold,
        Text = "â–¼",
        TextColor3 = Colors.TextDark,
        TextSize = 8,
    })
    
    local optionContainer = Utility.Create("Frame", {
        Name = "Options",
        Parent = container,
        BackgroundColor3 = Colors.Dropdown,
        BorderSizePixel = 0,
        Position = UDim2.new(0, 8, 0, 46),
        Size = UDim2.new(1, -16, 0, 0),
        ClipsDescendants = true,
    })
    
    local optionContainerStroke = Utility.CreateStroke(optionContainer, Colors.Border, 1)
    
    Utility.Create("UIListLayout", {
        Parent = optionContainer,
        SortOrder = Enum.SortOrder.LayoutOrder,
    })
    
    self.Tab.Library:RegisterThemeObject(container, {BackgroundColor3 = "BackgroundLight"})
    self.Tab.Library:RegisterThemeObject(containerStroke, {Color = "Border"})
    self.Tab.Library:RegisterThemeObject(label, {TextColor3 = "Text"})
    self.Tab.Library:RegisterThemeObject(dropdownButton, {BackgroundColor3 = "Dropdown", TextColor3 = "Text"})
    self.Tab.Library:RegisterThemeObject(dropdownStroke, {Color = "Border"})
    self.Tab.Library:RegisterThemeObject(arrow, {TextColor3 = "TextDark"})
    self.Tab.Library:RegisterThemeObject(optionContainer, {BackgroundColor3 = "Dropdown"})
    self.Tab.Library:RegisterThemeObject(optionContainerStroke, {Color = "Border"})
    
    local optionButtons = {}
    
    local function createOptions()
        for _, child in pairs(optionContainer:GetChildren()) do
            if child:IsA("TextButton") then
                child:Destroy()
            end
        end
        optionButtons = {}
        
        for _, option in pairs(options) do
            local optionButton = Utility.Create("TextButton", {
                Parent = optionContainer,
                BackgroundColor3 = Colors.Dropdown,
                BorderSizePixel = 0,
                Size = UDim2.new(1, 0, 0, 24),
                Font = Enum.Font.Gotham,
                Text = "  " .. tostring(option),
                TextColor3 = option == selected and Colors.Accent or Colors.Text,
                TextSize = 11,
                TextXAlignment = Enum.TextXAlignment.Left,
                AutoButtonColor = false,
            })
            
            table.insert(optionButtons, optionButton)
            self.Tab.Library:RegisterThemeObject(optionButton, {BackgroundColor3 = "Dropdown", TextColor3 = option == selected and "Accent" or "Text"})
            
            optionButton.MouseEnter:Connect(function()
                Utility.Tween(optionButton, {BackgroundColor3 = Colors.Accent, TextColor3 = Colors.PastelCream}, 0.1)
            end)
            
            optionButton.MouseLeave:Connect(function()
                Utility.Tween(optionButton, {BackgroundColor3 = Colors.Dropdown, TextColor3 = optionButton.Text == "  " .. tostring(selected) and Colors.Accent or Colors.Text}, 0.1)
            end)
            
            optionButton.MouseButton1Click:Connect(function()
                selected = option
                dropdownButton.Text = "  " .. tostring(selected)
                callback(selected)
                
                if flag then
                    self.Tab.Library.Flags[flag] = selected
                end
                
                for _, btn in pairs(optionButtons) do
                    btn.TextColor3 = btn.Text == "  " .. tostring(selected) and Colors.Accent or Colors.Text
                end
                
                opened = false
                Utility.Tween(container, {Size = UDim2.new(1, 0, 0, 50)}, 0.2)
                Utility.Tween(optionContainer, {Size = UDim2.new(1, -16, 0, 0)}, 0.2)
                Utility.Tween(arrow, {Rotation = 0}, 0.2)
            end)
        end
    end
    
    createOptions()
    
    local function toggleDropdown()
        opened = not opened
        local optionHeight = #options * 24
        
        if opened then
            Utility.Tween(container, {Size = UDim2.new(1, 0, 0, 50 + optionHeight + 4)}, 0.2)
            Utility.Tween(optionContainer, {Size = UDim2.new(1, -16, 0, optionHeight)}, 0.2)
            Utility.Tween(arrow, {Rotation = 180}, 0.2)
        else
            Utility.Tween(container, {Size = UDim2.new(1, 0, 0, 50)}, 0.2)
            Utility.Tween(optionContainer, {Size = UDim2.new(1, -16, 0, 0)}, 0.2)
            Utility.Tween(arrow, {Rotation = 0}, 0.2)
        end
    end
    
    dropdownButton.MouseButton1Click:Connect(toggleDropdown)
    
    dropdownButton.MouseEnter:Connect(function()
        Utility.Tween(dropdownStroke, {Color = Colors.Accent}, 0.15)
    end)
    
    dropdownButton.MouseLeave:Connect(function()
        Utility.Tween(dropdownStroke, {Color = Colors.Border}, 0.15)
    end)
    
    container.MouseEnter:Connect(function()
        Utility.Tween(label, {TextColor3 = Colors.Accent}, 0.15)
    end)
    
    container.MouseLeave:Connect(function()
        Utility.Tween(label, {TextColor3 = Colors.Text}, 0.15)
    end)
    
    if flag then
        self.Tab.Library.Flags[flag] = selected
    end
    
    return {
        Set = function(_, value)
            selected = value
            dropdownButton.Text = "  " .. tostring(selected)
            for _, btn in pairs(optionButtons) do
                btn.TextColor3 = btn.Text == "  " .. tostring(selected) and Colors.Accent or Colors.Text
            end
            callback(selected)
        end,
        Get = function()
            return selected
        end,
        Refresh = function(_, newOptions)
            options = newOptions
            createOptions()
        end
    }
end

function Section:AddMultiDropdown(config)
    config = config or {}
    local name = config.Name or "Multi Dropdown"
    local options = config.Options or {}
    local default = config.Default or {}
    local callback = config.Callback or function() end
    local flag = config.Flag
    
    local selected = {}
    for _, v in pairs(default) do
        selected[v] = true
    end
    local opened = false
    
    local container = Utility.Create("Frame", {
        Name = name,
        Parent = self.Content,
        BackgroundColor3 = Colors.BackgroundLight,
        BorderSizePixel = 0,
        Size = UDim2.new(1, 0, 0, 50),
        ClipsDescendants = true,
    })
    
    local containerStroke = Utility.CreateStroke(container, Colors.Border, 1)
    
    local label = Utility.Create("TextLabel", {
        Parent = container,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 8, 0, 2),
        Size = UDim2.new(1, -16, 0, 16),
        Font = Enum.Font.Gotham,
        Text = name,
        TextColor3 = Colors.Text,
        TextSize = 11,
        TextXAlignment = Enum.TextXAlignment.Left,
    })
    
    local function getSelectedText()
        local selectedList = {}
        for option, isSelected in pairs(selected) do
            if isSelected then
                table.insert(selectedList, option)
            end
        end
        if #selectedList == 0 then
            return "None"
        elseif #selectedList > 2 then
            return #selectedList .. " selected"
        else
            return table.concat(selectedList, ", ")
        end
    end
    
    local dropdownButton = Utility.Create("TextButton", {
        Name = "DropdownButton",
        Parent = container,
        BackgroundColor3 = Colors.Dropdown,
        BorderSizePixel = 0,
        Position = UDim2.new(0, 8, 0, 20),
        Size = UDim2.new(1, -16, 0, 24),
        Font = Enum.Font.Gotham,
        Text = "  " .. getSelectedText(),
        TextColor3 = Colors.Text,
        TextSize = 11,
        TextXAlignment = Enum.TextXAlignment.Left,
        AutoButtonColor = false,
    })
    
    local dropdownStroke = Utility.CreateStroke(dropdownButton, Colors.Border, 1)
    
    local arrow = Utility.Create("TextLabel", {
        Parent = dropdownButton,
        BackgroundTransparency = 1,
        Position = UDim2.new(1, -20, 0, 0),
        Size = UDim2.new(0, 20, 1, 0),
        Font = Enum.Font.GothamBold,
        Text = "â–¼",
        TextColor3 = Colors.TextDark,
        TextSize = 8,
    })
    
    local optionContainer = Utility.Create("Frame", {
        Name = "Options",
        Parent = container,
        BackgroundColor3 = Colors.Dropdown,
        BorderSizePixel = 0,
        Position = UDim2.new(0, 8, 0, 46),
        Size = UDim2.new(1, -16, 0, 0),
        ClipsDescendants = true,
    })
    
    local optionContainerStroke = Utility.CreateStroke(optionContainer, Colors.Border, 1)
    
    Utility.Create("UIListLayout", {
        Parent = optionContainer,
        SortOrder = Enum.SortOrder.LayoutOrder,
    })
    
    self.Tab.Library:RegisterThemeObject(container, {BackgroundColor3 = "BackgroundLight"})
    self.Tab.Library:RegisterThemeObject(containerStroke, {Color = "Border"})
    self.Tab.Library:RegisterThemeObject(label, {TextColor3 = "Text"})
    self.Tab.Library:RegisterThemeObject(dropdownButton, {BackgroundColor3 = "Dropdown", TextColor3 = "Text"})
    self.Tab.Library:RegisterThemeObject(dropdownStroke, {Color = "Border"})
    self.Tab.Library:RegisterThemeObject(arrow, {TextColor3 = "TextDark"})
    self.Tab.Library:RegisterThemeObject(optionContainer, {BackgroundColor3 = "Dropdown"})
    self.Tab.Library:RegisterThemeObject(optionContainerStroke, {Color = "Border"})
    
    local function updateButton()
        dropdownButton.Text = "  " .. getSelectedText()
        local selectedList = {}
        for option, isSelected in pairs(selected) do
            if isSelected then
                table.insert(selectedList, option)
            end
        end
        callback(selectedList)
        
        if flag then
            self.Tab.Library.Flags[flag] = selectedList
        end
    end
    
    for _, option in pairs(options) do
        local optionButton = Utility.Create("TextButton", {
            Parent = optionContainer,
            BackgroundColor3 = Colors.Dropdown,
            BorderSizePixel = 0,
            Size = UDim2.new(1, 0, 0, 24),
            Font = Enum.Font.Gotham,
            Text = "",
            AutoButtonColor = false,
        })
        
        local checkbox = Utility.Create("Frame", {
            Parent = optionButton,
            BackgroundColor3 = selected[option] and Colors.Toggle or Colors.ToggleOff,
            BorderSizePixel = 0,
            Position = UDim2.new(0, 6, 0.5, -6),
            Size = UDim2.new(0, 12, 0, 12),
        })
        
        Utility.CreateStroke(checkbox, Colors.Border, 1)
        
        local checkmark = Utility.Create("TextLabel", {
            Parent = checkbox,
            BackgroundTransparency = 1,
            Size = UDim2.new(1, 0, 1, 0),
            Font = Enum.Font.GothamBold,
            Text = selected[option] and "âœ“" or "",
            TextColor3 = Colors.PastelCream,
            TextSize = 10,
        })
        
        local optionLabel = Utility.Create("TextLabel", {
            Parent = optionButton,
            BackgroundTransparency = 1,
            Position = UDim2.new(0, 24, 0, 0),
            Size = UDim2.new(1, -30, 1, 0),
            Font = Enum.Font.Gotham,
            Text = tostring(option),
            TextColor3 = Colors.Text,
            TextSize = 11,
            TextXAlignment = Enum.TextXAlignment.Left,
        })
        
        self.Tab.Library:RegisterThemeObject(optionButton, {BackgroundColor3 = "Dropdown"})
        self.Tab.Library:RegisterThemeObject(optionLabel, {TextColor3 = "Text"})
        
        optionButton.MouseEnter:Connect(function()
            Utility.Tween(optionButton, {BackgroundColor3 = Colors.Accent}, 0.1)
        end)
        
        optionButton.MouseLeave:Connect(function()
            Utility.Tween(optionButton, {BackgroundColor3 = Colors.Dropdown}, 0.1)
        end)
        
        optionButton.MouseButton1Click:Connect(function()
            selected[option] = not selected[option]
            Utility.Tween(checkbox, {BackgroundColor3 = selected[option] and Colors.Toggle or Colors.ToggleOff}, 0.15)
            checkmark.Text = selected[option] and "âœ“" or ""
            updateButton()
        end)
    end
    
    local function toggleDropdown()
        opened = not opened
        local optionHeight = #options * 24
        
        if opened then
            Utility.Tween(container, {Size = UDim2.new(1, 0, 0, 50 + optionHeight + 4)}, 0.2)
            Utility.Tween(optionContainer, {Size = UDim2.new(1, -16, 0, optionHeight)}, 0.2)
            Utility.Tween(arrow, {Rotation = 180}, 0.2)
        else
            Utility.Tween(container, {Size = UDim2.new(1, 0, 0, 50)}, 0.2)
            Utility.Tween(optionContainer, {Size = UDim2.new(1, -16, 0, 0)}, 0.2)
            Utility.Tween(arrow, {Rotation = 0}, 0.2)
        end
    end
    
    dropdownButton.MouseButton1Click:Connect(toggleDropdown)
    
    dropdownButton.MouseEnter:Connect(function()
        Utility.Tween(dropdownStroke, {Color = Colors.Accent}, 0.15)
    end)
    
    dropdownButton.MouseLeave:Connect(function()
        Utility.Tween(dropdownStroke, {Color = Colors.Border}, 0.15)
    end)
    
    container.MouseEnter:Connect(function()
        Utility.Tween(label, {TextColor3 = Colors.Accent}, 0.15)
    end)
    
    container.MouseLeave:Connect(function()
        Utility.Tween(label, {TextColor3 = Colors.Text}, 0.15)
    end)
    
    return {
        Set = function(_, values)
            selected = {}
            for _, v in pairs(values) do
                selected[v] = true
            end
            updateButton()
        end,
        Get = function()
            local result = {}
            for option, isSelected in pairs(selected) do
                if isSelected then
                    table.insert(result, option)
                end
            end
            return result
        end
    }
end

function Section:AddKeybind(config)
    config = config or {}
    local name = config.Name or "Keybind"
    local default = config.Default or Enum.KeyCode.Unknown
    local callback = config.Callback or function() end
    local flag = config.Flag
    local showWidget = config.ShowWidget ~= false
    local mode = config.Mode or "Hold" -- "Always", "Toggle", "Hold"
    
    local currentKey = default
    local listening = false
    local isActive = mode == "Always"
    
    local container = Utility.Create("Frame", {
        Name = name,
        Parent = self.Content,
        BackgroundColor3 = Colors.BackgroundLight,
        BorderSizePixel = 0,
        Size = UDim2.new(1, 0, 0, 28),
    })
    
    local containerStroke = Utility.CreateStroke(container, Colors.Border, 1)
    
    local label = Utility.Create("TextLabel", {
        Parent = container,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 8, 0, 0),
        Size = UDim2.new(1, -130, 1, 0),
        Font = Enum.Font.Gotham,
        Text = name,
        TextColor3 = Colors.Text,
        TextSize = 11,
        TextXAlignment = Enum.TextXAlignment.Left,
        TextTruncate = Enum.TextTruncate.AtEnd,
    })
    
    local function getKeyDisplayName()
        if currentKey == Enum.KeyCode.Unknown or currentKey == Enum.KeyCode.Backspace then
            return "None"
        end
        return currentKey.Name
    end
    
    -- Mode selector
    local modeButton = Utility.Create("TextButton", {
        Name = "ModeButton",
        Parent = container,
        BackgroundColor3 = Colors.Dropdown,
        BorderSizePixel = 0,
        Position = UDim2.new(1, -120, 0.5, -10),
        Size = UDim2.new(0, 50, 0, 20),
        Font = Enum.Font.Gotham,
        Text = mode,
        TextColor3 = Colors.TextDark,
        TextSize = 9,
        AutoButtonColor = false,
    })
    
    local modeStroke = Utility.CreateStroke(modeButton, Colors.Border, 1)
    
    local keybindButton = Utility.Create("TextButton", {
        Name = "KeybindButton",
        Parent = container,
        BackgroundColor3 = Colors.Dropdown,
        BorderSizePixel = 0,
        Position = UDim2.new(1, -65, 0.5, -10),
        Size = UDim2.new(0, 57, 0, 20),
        Font = Enum.Font.GothamBold,
        Text = getKeyDisplayName(),
        TextColor3 = Colors.Accent,
        TextSize = 10,
        AutoButtonColor = false,
    })
    
    local keybindStroke = Utility.CreateStroke(keybindButton, Colors.Border, 1)
    
    self.Tab.Library:RegisterThemeObject(container, {BackgroundColor3 = "BackgroundLight"})
    self.Tab.Library:RegisterThemeObject(containerStroke, {Color = "Border"})
    self.Tab.Library:RegisterThemeObject(label, {TextColor3 = "Text"})
    self.Tab.Library:RegisterThemeObject(modeButton, {BackgroundColor3 = "Dropdown", TextColor3 = "TextDark"})
    self.Tab.Library:RegisterThemeObject(modeStroke, {Color = "Border"})
    self.Tab.Library:RegisterThemeObject(keybindButton, {BackgroundColor3 = "Dropdown", TextColor3 = "Accent"})
    self.Tab.Library:RegisterThemeObject(keybindStroke, {Color = "Border"})
    
    local function updateWidget()
        if showWidget then
            if currentKey == Enum.KeyCode.Unknown or currentKey == Enum.KeyCode.Backspace then
                if self.Tab.Library.KeybindWidgetEntries[name] then
                    self.Tab.Library:RemoveKeybindFromWidget(name)
                end
            else
                if not self.Tab.Library.KeybindWidgetEntries[name] then
                    self.Tab.Library:AddKeybindToWidget(name, currentKey, mode)
                else
                    self.Tab.Library:UpdateKeybindInWidget(name, currentKey, mode)
                end
            end
        end
        
        -- Update active state for "Always" mode
        if mode == "Always" then
            isActive = true
            self.Tab.Library:SetKeybindState(name, true)
            callback(true)
        end
    end
    
    if showWidget and currentKey ~= Enum.KeyCode.Unknown and currentKey ~= Enum.KeyCode.Backspace then
        self.Tab.Library:AddKeybindToWidget(name, currentKey, mode)
        if mode == "Always" then
            self.Tab.Library:SetKeybindState(name, true)
        end
    end
    
    -- Mode cycling
    local modes = {"Hold", "Toggle", "Always"}
    local modeIndex = 1
    for i, m in ipairs(modes) do
        if m == mode then
            modeIndex = i
            break
        end
    end
    
    modeButton.MouseButton1Click:Connect(function()
        modeIndex = modeIndex % 3 + 1
        mode = modes[modeIndex]
        modeButton.Text = mode
        
        -- Reset state when changing modes
        if mode == "Always" then
            isActive = true
            self.Tab.Library:SetKeybindState(name, true)
            callback(true)
        else
            isActive = false
            self.Tab.Library:SetKeybindState(name, false)
        end
        
        updateWidget()
    end)
    
    modeButton.MouseEnter:Connect(function()
        Utility.Tween(modeStroke, {Color = Colors.Accent}, 0.15)
    end)
    
    modeButton.MouseLeave:Connect(function()
        Utility.Tween(modeStroke, {Color = Colors.Border}, 0.15)
    end)
    
    keybindButton.MouseButton1Click:Connect(function()
        listening = true
        keybindButton.Text = "..."
        Utility.Tween(keybindStroke, {Color = Colors.Accent}, 0.15)
    end)
    
    keybindButton.MouseEnter:Connect(function()
        if not listening then
            Utility.Tween(keybindStroke, {Color = Colors.AccentLight}, 0.15)
        end
    end)
    
    keybindButton.MouseLeave:Connect(function()
        if not listening then
            Utility.Tween(keybindStroke, {Color = Colors.Border}, 0.15)
        end
    end)
    
    container.MouseEnter:Connect(function()
        Utility.Tween(label, {TextColor3 = Colors.Accent}, 0.15)
    end)
    
    container.MouseLeave:Connect(function()
        Utility.Tween(label, {TextColor3 = Colors.Text}, 0.15)
    end)
    
    UserInputService.InputBegan:Connect(function(input, gameProcessed)
        if listening then
            if input.UserInputType == Enum.UserInputType.Keyboard then
                if input.KeyCode == Enum.KeyCode.Backspace then
                    currentKey = Enum.KeyCode.Unknown
                else
                    currentKey = input.KeyCode
                end
                
                keybindButton.Text = getKeyDisplayName()
                listening = false
                Utility.Tween(keybindStroke, {Color = Colors.Border}, 0.15)
                
                updateWidget()
                
                if flag then
                    self.Tab.Library.Flags[flag] = currentKey
                end
            end
        elseif not gameProcessed and currentKey ~= Enum.KeyCode.Unknown and input.KeyCode == currentKey then
            if mode == "Toggle" then
                isActive = not isActive
                self.Tab.Library:SetKeybindState(name, isActive)
                callback(isActive)
            elseif mode == "Hold" then
                isActive = true
                self.Tab.Library:SetKeybindState(name, true)
                callback(true)
            end
            -- "Always" mode is always active, no need to handle
        end
    end)
    
    UserInputService.InputEnded:Connect(function(input)
        if not listening and currentKey ~= Enum.KeyCode.Unknown and input.KeyCode == currentKey then
            if mode == "Hold" then
                isActive = false
                self.Tab.Library:SetKeybindState(name, false)
                callback(false)
            end
        end
    end)
    
    if flag then
        self.Tab.Library.Flags[flag] = currentKey
    end
    
    -- Initialize "Always" mode
    if mode == "Always" then
        isActive = true
        callback(true)
    end
    
    return {
        Set = function(_, key)
            if key == Enum.KeyCode.Backspace then
                key = Enum.KeyCode.Unknown
            end
            currentKey = key
            keybindButton.Text = getKeyDisplayName()
            updateWidget()
        end,
        Get = function()
            return currentKey
        end,
        GetState = function()
            return isActive
        end,
        SetMode = function(_, newMode)
            for i, m in ipairs(modes) do
                if m == newMode then
                    modeIndex = i
                    mode = newMode
                    modeButton.Text = mode
                    
                    if mode == "Always" then
                        isActive = true
                        self.Tab.Library:SetKeybindState(name, true)
                        callback(true)
                    else
                        isActive = false
                        self.Tab.Library:SetKeybindState(name, false)
                    end
                    
                    updateWidget()
                    break
                end
            end
        end,
        GetMode = function()
            return mode
        end
    }
end

function Section:AddColorPicker(config)
    config = config or {}
    local name = config.Name or "Color Picker"
    local default = config.Default or Color3.fromRGB(139, 90, 43)
    local callback = config.Callback or function() end
    local flag = config.Flag
    
    local currentColor = default
    local opened = false
    
    local container = Utility.Create("Frame", {
        Name = name,
        Parent = self.Content,
        BackgroundColor3 = Colors.BackgroundLight,
        BorderSizePixel = 0,
        Size = UDim2.new(1, 0, 0, 28),
        ClipsDescendants = true,
    })
    
    local containerStroke = Utility.CreateStroke(container, Colors.Border, 1)
    
    local label = Utility.Create("TextLabel", {
        Parent = container,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 8, 0, 0),
        Size = UDim2.new(1, -45, 0, 28),
        Font = Enum.Font.Gotham,
        Text = name,
        TextColor3 = Colors.Text,
        TextSize = 11,
        TextXAlignment = Enum.TextXAlignment.Left,
    })
    
    local colorButton = Utility.Create("TextButton", {
        Name = "ColorButton",
        Parent = container,
        BackgroundColor3 = currentColor,
        BorderSizePixel = 0,
        Position = UDim2.new(1, -35, 0, 6),
        Size = UDim2.new(0, 27, 0, 16),
        Text = "",
        AutoButtonColor = false,
    })
    
    local colorButtonStroke = Utility.CreateStroke(colorButton, Colors.Border, 1)
    
    local pickerContainer = Utility.Create("Frame", {
        Name = "Picker",
        Parent = container,
        BackgroundColor3 = Colors.Dropdown,
        BorderSizePixel = 0,
        Position = UDim2.new(0, 8, 0, 32),
        Size = UDim2.new(1, -16, 0, 140),
        Visible = false,
    })
    
    Utility.CreateStroke(pickerContainer, Colors.Border, 1)
    
    self.Tab.Library:RegisterThemeObject(container, {BackgroundColor3 = "BackgroundLight"})
    self.Tab.Library:RegisterThemeObject(containerStroke, {Color = "Border"})
    self.Tab.Library:RegisterThemeObject(label, {TextColor3 = "Text"})
    self.Tab.Library:RegisterThemeObject(colorButtonStroke, {Color = "Border"})
    self.Tab.Library:RegisterThemeObject(pickerContainer, {BackgroundColor3 = "Dropdown"})
    
    -- Color wheel
    local colorWheel = Utility.Create("ImageLabel", {
        Name = "ColorWheel",
        Parent = pickerContainer,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 5, 0, 5),
        Size = UDim2.new(0, 100, 0, 100),
        Image = "rbxassetid://6523286724", -- Color wheel image
    })
    
    local wheelCursor = Utility.Create("Frame", {
        Name = "Cursor",
        Parent = colorWheel,
        BackgroundColor3 = Color3.new(1, 1, 1),
        BorderSizePixel = 0,
        Size = UDim2.new(0, 8, 0, 8),
        AnchorPoint = Vector2.new(0.5, 0.5),
        Position = UDim2.new(0.5, 0, 0.5, 0),
    })
    
    Utility.Create("UICorner", {
        Parent = wheelCursor,
        CornerRadius = UDim.new(1, 0),
    })
    
    Utility.CreateStroke(wheelCursor, Color3.new(0, 0, 0), 2)
    
    -- Brightness slider
    local brightnessBar = Utility.Create("Frame", {
        Name = "BrightnessBar",
        Parent = pickerContainer,
        BackgroundColor3 = Color3.new(1, 1, 1),
        BorderSizePixel = 0,
        Position = UDim2.new(0, 110, 0, 5),
        Size = UDim2.new(0, 15, 0, 100),
    })
    
    local brightnessGradient = Utility.Create("UIGradient", {
        Parent = brightnessBar,
        Color = ColorSequence.new({
            ColorSequenceKeypoint.new(0, Color3.new(1, 1, 1)),
            ColorSequenceKeypoint.new(1, Color3.new(0, 0, 0))
        }),
        Rotation = 90,
    })
    
    Utility.CreateStroke(brightnessBar, Colors.Border, 1)
    
    local brightnessCursor = Utility.Create("Frame", {
        Name = "Cursor",
        Parent = brightnessBar,
        BackgroundColor3 = Color3.new(1, 1, 1),
        BorderSizePixel = 0,
        Size = UDim2.new(1, 4, 0, 4),
        Position = UDim2.new(0, -2, 0, 0),
        AnchorPoint = Vector2.new(0, 0.5),
    })
    
    Utility.CreateStroke(brightnessCursor, Color3.new(0, 0, 0), 1)
    
    -- RGB Input section
    local rgbContainer = Utility.Create("Frame", {
        Name = "RGBContainer",
        Parent = pickerContainer,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 130, 0, 5),
        Size = UDim2.new(1, -140, 0, 100),
    })
    
    local function createRGBInput(labelText, yPos, defaultValue)
        local inputContainer = Utility.Create("Frame", {
            Parent = rgbContainer,
            BackgroundTransparency = 1,
            Position = UDim2.new(0, 0, 0, yPos),
            Size = UDim2.new(1, 0, 0, 28),
        })
        
        local inputLabel = Utility.Create("TextLabel", {
            Parent = inputContainer,
            BackgroundTransparency = 1,
            Position = UDim2.new(0, 0, 0, 0),
            Size = UDim2.new(0, 20, 1, 0),
            Font = Enum.Font.GothamBold,
            Text = labelText,
            TextColor3 = Colors.Text,
            TextSize = 11,
            TextXAlignment = Enum.TextXAlignment.Left,
        })
        
        local inputBox = Utility.Create("TextBox", {
            Parent = inputContainer,
            BackgroundColor3 = Colors.BackgroundLight,
            BorderSizePixel = 0,
            Position = UDim2.new(0, 22, 0, 2),
            Size = UDim2.new(1, -24, 0, 20),
            Font = Enum.Font.Gotham,
            Text = tostring(defaultValue),
            TextColor3 = Colors.Text,
            TextSize = 10,
            ClearTextOnFocus = true,
        })
        
        Utility.CreateStroke(inputBox, Colors.Border, 1)
        
        self.Tab.Library:RegisterThemeObject(inputLabel, {TextColor3 = "Text"})
        self.Tab.Library:RegisterThemeObject(inputBox, {BackgroundColor3 = "BackgroundLight", TextColor3 = "Text"})
        
        return inputBox
    end
    
    local rInput = createRGBInput("R", 0, math.floor(currentColor.R * 255))
    local gInput = createRGBInput("G", 32, math.floor(currentColor.G * 255))
    local bInput = createRGBInput("B", 64, math.floor(currentColor.B * 255))
    
    -- Preview
    local previewLabel = Utility.Create("TextLabel", {
        Parent = pickerContainer,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 8, 0, 110),
        Size = UDim2.new(0, 50, 0, 20),
        Font = Enum.Font.Gotham,
        Text = "Preview:",
        TextColor3 = Colors.TextDark,
        TextSize = 10,
        TextXAlignment = Enum.TextXAlignment.Left,
    })
    
    local previewBox = Utility.Create("Frame", {
        Name = "Preview",
        Parent = pickerContainer,
        BackgroundColor3 = currentColor,
        BorderSizePixel = 0,
        Position = UDim2.new(0, 60, 0, 112),
        Size = UDim2.new(1, -70, 0, 18),
    })
    
    Utility.CreateStroke(previewBox, Colors.Border, 1)
    
    self.Tab.Library:RegisterThemeObject(previewLabel, {TextColor3 = "TextDark"})
    
    local h, s, v = currentColor:ToHSV()
    
    local function updateColor(skipInputs)
        currentColor = Color3.fromHSV(h, s, v)
        colorButton.BackgroundColor3 = currentColor
        previewBox.BackgroundColor3 = currentColor
        
        -- Update brightness gradient to show current hue
        brightnessGradient.Color = ColorSequence.new({
            ColorSequenceKeypoint.new(0, Color3.fromHSV(h, s, 1)),
            ColorSequenceKeypoint.new(1, Color3.new(0, 0, 0))
        })
        
        if not skipInputs then
            rInput.Text = tostring(math.floor(currentColor.R * 255))
            gInput.Text = tostring(math.floor(currentColor.G * 255))
            bInput.Text = tostring(math.floor(currentColor.B * 255))
        end
        
        callback(currentColor)
        
        if flag then
            self.Tab.Library.Flags[flag] = currentColor
        end
    end
    
    local function updateCursors()
        -- Position wheel cursor based on hue and saturation
        local angle = h * math.pi * 2
        local radius = s * 50
        local x = 50 + math.cos(angle) * radius
        local y = 50 + math.sin(angle) * radius
        wheelCursor.Position = UDim2.new(0, x, 0, y)
        
        -- Position brightness cursor
        brightnessCursor.Position = UDim2.new(0, -2, 1 - v, 0)
    end
    
    updateCursors()
    
    -- Color wheel interaction
    local wheelDragging = false
    
    colorWheel.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            wheelDragging = true
        end
    end)
    
    colorWheel.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            wheelDragging = false
        end
    end)
    
    -- Brightness bar interaction
    local brightnessDragging = false
    
    brightnessBar.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            brightnessDragging = true
        end
    end)
    
    brightnessBar.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            brightnessDragging = false
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then
            if wheelDragging then
                local centerX = colorWheel.AbsolutePosition.X + colorWheel.AbsoluteSize.X / 2
                local centerY = colorWheel.AbsolutePosition.Y + colorWheel.AbsoluteSize.Y / 2
                local dx = input.Position.X - centerX
                local dy = input.Position.Y - centerY
                
                local angle = math.atan2(dy, dx)
                h = (angle / (math.pi * 2)) % 1
                
                local distance = math.sqrt(dx * dx + dy * dy)
                local maxRadius = colorWheel.AbsoluteSize.X / 2
                s = math.clamp(distance / maxRadius, 0, 1)
                
                updateColor()
                updateCursors()
            elseif brightnessDragging then
                local relativeY = (input.Position.Y - brightnessBar.AbsolutePosition.Y) / brightnessBar.AbsoluteSize.Y
                v = 1 - math.clamp(relativeY, 0, 1)
                
                updateColor()
                updateCursors()
            end
        end
    end)
    
    -- RGB input handlers
    local function onRGBInputChanged()
        local r = tonumber(rInput.Text) or 0
        local g = tonumber(gInput.Text) or 0
        local b = tonumber(bInput.Text) or 0
        
        r = math.clamp(r, 0, 255) / 255
        g = math.clamp(g, 0, 255) / 255
        b = math.clamp(b, 0, 255) / 255
        
        h, s, v = Utility.RGBToHSV(r, g, b)
        updateColor(true)
        updateCursors()
    end
    
    rInput.FocusLost:Connect(onRGBInputChanged)
    gInput.FocusLost:Connect(onRGBInputChanged)
    bInput.FocusLost:Connect(onRGBInputChanged)
    
    colorButton.MouseButton1Click:Connect(function()
        opened = not opened
        pickerContainer.Visible = opened
        
        if opened then
            Utility.Tween(container, {Size = UDim2.new(1, 0, 0, 180)}, 0.2)
        else
            Utility.Tween(container, {Size = UDim2.new(1, 0, 0, 28)}, 0.2)
        end
    end)
    
    container.MouseEnter:Connect(function()
        Utility.Tween(label, {TextColor3 = Colors.Accent}, 0.15)
    end)
    
    container.MouseLeave:Connect(function()
        Utility.Tween(label, {TextColor3 = Colors.Text}, 0.15)
    end)
    
    if flag then
        self.Tab.Library.Flags[flag] = currentColor
    end
    
    return {
        Set = function(_, color)
            currentColor = color
            h, s, v = color:ToHSV()
            updateColor()
            updateCursors()
        end,
        Get = function()
            return currentColor
        end
    }
end

function Section:AddLabel(config)
    config = config or {}
    local text = config.Text or "Label"
    
    local label = Utility.Create("TextLabel", {
        Name = "Label",
        Parent = self.Content,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 16),
        Font = Enum.Font.Gotham,
        Text = text,
        TextColor3 = Colors.TextDark,
        TextSize = 11,
        TextXAlignment = Enum.TextXAlignment.Left,
    })
    
    self.Tab.Library:RegisterThemeObject(label, {TextColor3 = "TextDark"})
    
    return {
        Set = function(_, newText)
            label.Text = newText
        end
    }
end

function Section:AddTextBox(config)
    config = config or {}
    local name = config.Name or "TextBox"
    local default = config.Default or ""
    local placeholder = config.Placeholder or "Enter text..."
    local callback = config.Callback or function() end
    local flag = config.Flag
    
    local container = Utility.Create("Frame", {
        Name = name,
        Parent = self.Content,
        BackgroundColor3 = Colors.BackgroundLight,
        BorderSizePixel = 0,
        Size = UDim2.new(1, 0, 0, 50),
    })
    
    local containerStroke = Utility.CreateStroke(container, Colors.Border, 1)
    
    local label = Utility.Create("TextLabel", {
        Parent = container,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 8, 0, 2),
        Size = UDim2.new(1, -16, 0, 16),
        Font = Enum.Font.Gotham,
        Text = name,
        TextColor3 = Colors.Text,
        TextSize = 11,
        TextXAlignment = Enum.TextXAlignment.Left,
    })
    
    local textBox = Utility.Create("TextBox", {
        Parent = container,
        BackgroundColor3 = Colors.Dropdown,
        BorderSizePixel = 0,
        Position = UDim2.new(0, 8, 0, 22),
        Size = UDim2.new(1, -16, 0, 22),
        Font = Enum.Font.Gotham,
        PlaceholderText = placeholder,
        PlaceholderColor3 = Colors.TextDisabled,
        Text = default,
        TextColor3 = Colors.Text,
        TextSize = 11,
        TextXAlignment = Enum.TextXAlignment.Left,
        ClearTextOnFocus = false,
    })
    
    Utility.Create("UIPadding", {
        Parent = textBox,
        PaddingLeft = UDim.new(0, 6),
        PaddingRight = UDim.new(0, 6),
    })
    
    local textBoxStroke = Utility.CreateStroke(textBox, Colors.Border, 1)
    
    self.Tab.Library:RegisterThemeObject(container, {BackgroundColor3 = "BackgroundLight"})
    self.Tab.Library:RegisterThemeObject(containerStroke, {Color = "Border"})
    self.Tab.Library:RegisterThemeObject(label, {TextColor3 = "Text"})
    self.Tab.Library:RegisterThemeObject(textBox, {BackgroundColor3 = "Dropdown", TextColor3 = "Text", PlaceholderColor3 = "TextDisabled"})
    self.Tab.Library:RegisterThemeObject(textBoxStroke, {Color = "Border"})
    
    textBox.Focused:Connect(function()
        Utility.Tween(textBoxStroke, {Color = Colors.Accent}, 0.15)
    end)
    
    textBox.FocusLost:Connect(function()
        Utility.Tween(textBoxStroke, {Color = Colors.Border}, 0.15)
        callback(textBox.Text)
        
        if flag then
            self.Tab.Library.Flags[flag] = textBox.Text
        end
    end)
    
    container.MouseEnter:Connect(function()
        Utility.Tween(label, {TextColor3 = Colors.Accent}, 0.15)
    end)
    
    container.MouseLeave:Connect(function()
        Utility.Tween(label, {TextColor3 = Colors.Text}, 0.15)
    end)
    
    if flag then
        self.Tab.Library.Flags[flag] = default
    end
    
    return {
        Set = function(_, text)
            textBox.Text = text
            callback(text)
        end,
        Get = function()
            return textBox.Text
        end
    }
end

function MilkChocolate:GetThemes()
    local themeNames = {}
    for name, _ in pairs(Themes) do
        table.insert(themeNames, name)
    end
    return themeNames
end

return MilkChocolate
